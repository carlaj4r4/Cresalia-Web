<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Comunidad de Compradores - Cresalia</title>
    
    <!-- Meta Security -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' cdnjs.cloudflare.com cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' fonts.googleapis.com cdnjs.cloudflare.com cdn.jsdelivr.net; style-src-elem 'self' 'unsafe-inline' fonts.googleapis.com cdnjs.cloudflare.com cdn.jsdelivr.net; font-src 'self' fonts.gstatic.com cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https:; frame-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="assets/logo/logo-cresalia.png">
    <link rel="apple-touch-icon" href="assets/logo/logo-cresalia.png">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Sistema de Seguridad -->
    <script src="security-system.js?v=2.0"></script>
    <script src="core/proteccion-devtools-avanzada.js?v=2.0"></script>
    <script src="core/proteccion-datos-sensibles.js?v=1.0"></script>
    <script src="core/panel-monitoreo-seguridad.js?v=1.0"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Ocultar notificaciones molestas */
        .notification, .alert, .toast, .popup {
            display: none !important;
        }
        
        /* Ocultar mensajes de media query */
        [class*="media-query"], [class*="responsive"], [class*="breakpoint"] {
            display: none !important;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            width: 100%;
            overflow-x: hidden;
        }
        
        .container-main {
            max-width: 100%;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 0;
            margin-bottom: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .back-btn {
            display: inline-block;
            background: white;
            color: #667eea;
            padding: 12px 25px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
        }
        
        .reportar-section {
            background: #FEF2F2;
            border: 2px solid #FECACA;
            border-radius: 0;
            padding: 25px;
            margin-bottom: 0;
        }
        
        .reportar-section h4 {
            color: #DC2626;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .reportar-form {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .reportar-form input, .reportar-form textarea, .reportar-form select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .reportar-form textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .reportar-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .btn-reportar {
            background: linear-gradient(135deg, #DC2626, #EF4444);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .btn-reportar:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
        }
        
        .btn-bloquear {
            background: linear-gradient(135deg, #8B5CF6, #A78BFA);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .btn-bloquear:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }
        
        .lista-reportar {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .lista-reportar h5 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .item-reportar {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #DC2626;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .item-reportar .info {
            flex: 1;
        }
        
        .item-reportar .info h6 {
            color: #333;
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }
        
        .item-reportar .info p {
            color: #666;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .item-reportar .info .motivo {
            color: #DC2626;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        
        .btn-desbloquear {
            background: #10B981;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-desbloquear:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .no-reportes {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }
        
        .info-importante {
            background: #FEF3C7;
            border: 2px solid #F59E0B;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 0;
        }
        
        .info-importante h5 {
            color: #92400E;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-importante p {
            color: #92400E;
            margin: 0;
            font-size: 0.95rem;
        }

        .cumple-resumen {
            background: #0F172A;
            color: #E2E8F0;
            border-radius: 18px;
            padding: 26px;
            margin: 25px 0;
            box-shadow: 0 18px 35px rgba(15, 23, 42, 0.35);
            border: 1px solid rgba(148, 163, 184, 0.25);
            position: relative;
            overflow: hidden;
        }

        .cumple-resumen::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(14, 165, 233, 0.35), transparent 50%);
            pointer-events: none;
        }

        .cumple-resumen header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .cumple-resumen header h2 {
            margin: 0;
            color: #38BDF8;
        }

        .cumple-resumen header p {
            margin: 0;
            color: #CBD5F5;
            font-size: 0.95rem;
        }

        .cumple-resumen-datos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .cumple-resumen-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 14px;
            padding: 18px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 25px rgba(30, 41, 59, 0.35);
        }

        .cumple-resumen-card h3 {
            margin: 0 0 8px 0;
            font-size: 1rem;
            color: #E0E7FF;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cumple-resumen-card p {
            margin: 0;
            font-size: 0.95rem;
            color: #CBD5F5;
        }

        .cumple-resumen .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .cumple-resumen .chip {
            background: rgba(59, 130, 246, 0.2);
            color: #93C5FD;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .cumple-resumen ul {
            list-style: none;
            margin: 10px 0 0 0;
            padding: 0;
            display: grid;
            gap: 6px;
        }

        .cumple-resumen li {
            font-size: 0.9rem;
            color: #E2E8F0;
        }

        .cumple-resumen li strong {
            color: #38BDF8;
        }

        .resumen-empty {
            margin: 0;
            font-style: italic;
            color: #94A3B8;
        }

        .cumple-resumen.cargando::before {
            content: 'Cargando resumen...';
            position: absolute;
            top: 18px;
            right: 18px;
            font-size: 0.85rem;
            color: rgba(148, 163, 184, 0.7);
        }

        .cumple-resumen.error::before {
            content: attr(data-error);
            position: absolute;
            top: 18px;
            right: 18px;
            font-size: 0.85rem;
            color: #FCA5A5;
        }

        .cumple-compradores {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(14, 165, 233, 0.18));
            border-radius: 16px;
            padding: 28px;
            margin: 30px 0;
            box-shadow: 0 10px 35px rgba(88, 28, 135, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        .cumple-compradores header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 18px;
        }

        .cumple-compradores h2 {
            margin: 0;
            color: #5B21B6;
            font-size: 1.8rem;
        }

        .cumple-compradores p {
            margin: 0;
            color: #4338CA;
            line-height: 1.5;
        }

        .cumple-compradores-consent {
            background: rgba(255, 255, 255, 0.75);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            border: 1px dashed rgba(79, 70, 229, 0.35);
            margin-bottom: 22px;
        }

        .cumple-compradores-consent strong {
            color: #312E81;
        }

        .cumple-compradores-consent span {
            color: #4338CA;
            font-size: 0.95rem;
        }

        .cumple-compradores-destacados {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 14px;
            padding: 20px 22px;
            border: 1px solid rgba(14, 165, 233, 0.25);
            margin-bottom: 24px;
            box-shadow: inset 0 0 0 1px rgba(124, 58, 237, 0.08);
        }

        .cumple-compradores-destacados h3 {
            margin: 0 0 14px 0;
            color: #0F172A;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cumple-compradores-destacados h3 i {
            color: #38BDF8;
        }

        .cumple-compradores-lista {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin-top: 10px;
        }

        .cumple-compradores-card {
            display: grid;
            grid-template-columns: 56px 1fr auto;
            align-items: center;
            gap: 14px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 14px;
            border: 1px solid rgba(124, 58, 237, 0.12);
            backdrop-filter: blur(6px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.12);
        }

        .cumple-compradores-card.destacado {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.15), rgba(124, 58, 237, 0.18));
            border: 1px solid rgba(14, 165, 233, 0.3);
            box-shadow: 0 12px 28px rgba(14, 165, 233, 0.22);
        }

        .cumple-compradores-interacciones {
            grid-column: 1 / -1;
            margin-top: 16px;
            display: grid;
            gap: 12px;
        }

        .cumple-compradores-actions {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        .cumple-compradores-actions button {
            border: none;
            border-radius: 999px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .cumple-compradores-actions button.enviar-abrazo {
            background: linear-gradient(135deg, #EC4899, #C026D3);
            color: white;
            box-shadow: 0 6px 16px rgba(236, 72, 153, 0.25);
        }

        .cumple-compradores-actions button.enviar-abrazo:disabled {
            filter: grayscale(0.1);
            opacity: 0.85;
            cursor: default;
        }

        .cumple-compradores-actions button.dejar-mensaje {
            background: rgba(255, 255, 255, 0.85);
            color: #4C1D95;
            border: 1px solid rgba(124, 58, 237, 0.25);
        }

        .cumple-compradores-actions button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(59, 130, 246, 0.18);
        }

        .cumple-compradores-actions .contador-abrazos {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: #5B21B6;
            background: rgba(124, 58, 237, 0.12);
            border-radius: 999px;
            padding: 6px 12px;
        }

        .cumple-compradores-respuestas {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            border-left: 3px solid rgba(99, 102, 241, 0.45);
            padding: 12px 16px;
            color: #312E81;
            display: grid;
            gap: 10px;
        }

        .cumple-compradores-respuestas h5 {
            margin: 0;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4338CA;
        }

        .cumple-compradores-respuestas ul {
            margin: 0;
            padding-left: 18px;
            display: grid;
            gap: 6px;
        }

        .cumple-compradores-respuestas li {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .cumple-compradores-respuestas li strong {
            color: #4C1D95;
        }

        .cumple-compradores-respuestas .sin-mensajes {
            font-style: italic;
            color: #6B21A8;
        }

        .cumple-compradores-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7C3AED, #0EA5E9);
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.3rem;
            overflow: hidden;
        }

        .cumple-compradores-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cumple-compradores-info h4 {
            margin: 0;
            color: #312E81;
            font-size: 1.1rem;
        }

        .cumple-compradores-meta {
            margin: 6px 0 0 0;
            color: #4338CA;
            font-size: 0.9rem;
        }

        .cumple-compradores-mensaje {
            margin: 10px 0 0 0;
            padding-left: 10px;
            border-left: 3px solid rgba(124, 58, 237, 0.35);
            color: #4C1D95;
            font-style: italic;
            font-size: 0.9rem;
        }

        .cumple-compradores-badge {
            display: inline-block;
            margin-top: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(14, 165, 233, 0.18);
            color: #0369A1;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .cumple-compradores-dia {
            background: linear-gradient(135deg, #5B21B6, #0EA5E9);
            color: white;
            font-weight: 700;
            font-size: 1.35rem;
            padding: 12px 14px;
            border-radius: 12px;
            min-width: 54px;
            text-align: center;
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.15);
        }

        .cumple-compradores-empty {
            text-align: center;
            color: #4338CA;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 30px 20px;
            border: 1px dashed rgba(79, 70, 229, 0.35);
            margin-top: 10px;
        }

        .cumple-compradores-empty i {
            font-size: 2rem;
            color: #5B21B6;
            margin-bottom: 12px;
        }
        
        /* Responsive para m√≥vil y tablet */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                margin: 0;
                width: 100vw;
                min-width: 100vw;
                overflow-x: hidden;
            }
            
            .container-main {
                max-width: 100%;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .header {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .card {
                padding: 20px 15px;
                margin-bottom: 15px;
            }

            .cumple-resumen {
                padding: 22px;
                margin: 20px 0;
            }

            .cumple-resumen-datos {
                grid-template-columns: 1fr;
            }

            .cumple-compradores {
                padding: 22px 18px;
                margin: 20px 0;
            }

            .cumple-compradores-card {
                grid-template-columns: 46px 1fr;
                grid-template-rows: auto auto;
                gap: 10px;
            }

            .cumple-compradores-destacados {
                padding: 18px;
            }

            .cumple-compradores-dia {
                grid-column: span 2;
                justify-self: flex-start;
                font-size: 1.1rem;
            }

            .cumple-compradores-interacciones {
                margin-top: 12px;
            }

            .cumple-compradores-actions {
                gap: 8px;
            }

            .cumple-compradores-actions button {
                width: 100%;
                justify-content: center;
            }
            
            .card h4 {
                font-size: 1.2rem;
            }
            
            .grid-2-columns {
                display: block !important;
                gap: 15px;
            }
            
            .lista-reportar {
                margin-bottom: 20px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                margin: 5px 2px;
            }
            
            .form-control {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .modal-content {
                margin: 10px;
                max-width: calc(100vw - 20px);
                width: calc(100vw - 20px);
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .header {
                padding: 15px 10px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .card {
                padding: 15px 10px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.8rem;
                width: 100%;
                margin: 3px 0;
            }

            .cumple-resumen {
                padding: 18px;
            }

            .cumple-resumen-card {
                padding: 16px;
            }

            .cumple-resumen header h2 {
                font-size: 1.25rem;
            }

            .cumple-compradores-actions button {
                font-size: 0.85rem;
            }

            .cumple-compradores-respuestas {
                padding: 10px 12px;
            }
            
            .modal-content {
                margin: 5px;
                max-width: calc(100vw - 10px);
                width: calc(100vw - 10px);
            }
        }
    </style>
    
    <!-- Diagn√≥stico Responsive -->
    <script src="js/diagnostico-responsive.js"></script>
</head>
<body>
    <div class="container-main">
        <a href="tiendas/ejemplo-tienda/index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> Volver a la Tienda
        </a>
        
        <div class="header">
            <h1>üõí Comunidad de Compradores Cresalia</h1>
            <p>Espacio seguro para protegernos y comprar con confianza üíú</p>
        </div>

        <section class="cumple-resumen" id="cumpleaneros-resumen">
            <header>
                <h2>üåü Resumen mensual de cumplea√±os</h2>
                <p>Alentemos a quienes celebran durante este mes. Estas m√©tricas se actualizan en vivo con abrazos, mensajes y beneficios otorgados.</p>
            </header>
            <div class="cumple-resumen-datos">
                <article class="cumple-resumen-card">
                    <h3><i class="fas fa-calendar-check"></i> Celebraciones</h3>
                    <p data-total-celebrantes>‚Äî</p>
                    <div class="chips">
                        <span class="chip" data-celebran-hoy>Revisando...</span>
                    </div>
                    <ul data-proximos></ul>
                </article>
                <article class="cumple-resumen-card">
                    <h3><i class="fas fa-heart"></i> Cari√±o de la comunidad</h3>
                    <p data-total-abrazos>‚Äî</p>
                    <p style="margin-top:6px;" data-total-mensajes>‚Äî</p>
                    <ul data-mensajes-recientes></ul>
                </article>
                <article class="cumple-resumen-card">
                    <h3><i class="fas fa-gift"></i> Beneficios entregados</h3>
                    <p data-cupones-generados>‚Äî</p>
                    <p style="margin-top:6px;" data-upgrades>‚Äî</p>
                    <p style="margin-top:10px; font-size:0.85rem; color:#94A3B8;">
                        Los upgrades y cupones se registran autom√°ticamente cuando el cron diario procesa cumplea√±os.
                    </p>
                </article>
            </div>
        </section>

        <section class="cumple-compradores" id="cumpleaneros-compradores">
            <header>
                <h2>üéÇ Cumplea√±os de la Comunidad</h2>
                <p>Durante <strong data-mes-actual>este mes</strong> celebramos a quienes dijeron ‚Äús√≠‚Äù a compartir su d√≠a para recibir cari√±o y sorpresas.</p>
            </header>

            <div class="cumple-compradores-consent">
                <strong>Respeto y consentimiento primero.</strong>
                <span data-consent-aviso>Nadie aparece aqu√≠ sin activar la opci√≥n de cumplea√±os p√∫blico en su perfil.</span>
                <span>Si todav√≠a no te sumaste, pod√©s activar tu beneficio y la visibilidad desde tu panel de comprador cuando quieras.</span>
            </div>

            <div class="cumple-compradores-destacados" data-destacados-wrapper style="display: none;">
                <h3><i class="fas fa-heart"></i> Mensajes que quieren abrazos extra</h3>
                <div class="cumple-compradores-lista" data-destacados></div>
            </div>

            <div class="cumple-compradores-lista" data-listado></div>

            <div class="cumple-compradores-empty" data-empty style="display: none;">
                <i class="fas fa-gift"></i>
                <p>Cuando alguien acepte compartir su cumplea√±os, lo vas a ver aqu√≠ para que le dejemos mucho cari√±o üíú</p>
            </div>
        </section>
        
        <!-- Informaci√≥n importante -->
        <div class="info-importante">
            <h5><i class="fas fa-info-circle"></i> Informaci√≥n Importante</h5>
            <p>Esta comunidad est√° dise√±ada para proteger a los compradores. Puedes reportar vendedores problem√°ticos y bloquearlos individualmente. Con 3+ reportes de diferentes compradores, el administrador proceder√° a tomar medidas.</p>
        </div>
        
        <!-- Secci√≥n: Foro de la Comunidad -->
        <div class="foro-comunidad-section" style="background: white; border-radius: 15px; padding: 30px; margin-top: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
            <div class="foro-header" style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #333; margin-bottom: 10px;">
                    <i class="fas fa-comments" style="color: #667eea;"></i> 
                    Foro de la Comunidad
                </h2>
                <p style="color: #666; font-size: 1.1rem; line-height: 1.8;">
                    Un espacio profesional y respetuoso para compartir experiencias de compra, consejos y apoyarnos mutuamente como consumidores informados.
                </p>
                <div class="info-box" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(124, 58, 237, 0.1)); border-left: 4px solid #667eea; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <p style="margin: 0; line-height: 1.8; color: #4c1d95;">
                        <strong>üíú Nuestro compromiso:</strong> Este espacio est√° dise√±ado para el crecimiento y el apoyo mutuo. 
                        Mantengamos un ambiente respetuoso, emp√°tico y constructivo. Todas las opiniones son v√°lidas cuando se expresan con respeto.
                    </p>
                </div>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; flex-wrap: wrap;">
                <button id="btn-mi-historial" class="btn-secondary" style="padding: 15px 30px; font-size: 1.1rem; border-radius: 25px;" onclick="mostrarHistorialForo()">
                    <i class="fas fa-history"></i> Mi Historial
                </button>
            </div>
            
            <!-- Contenedor de posts -->
            <div id="posts-container" style="min-height: 200px;">
                <div class="empty-state" style="text-align: center; padding: 40px; color: #64748b;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                    <p>Cargando publicaciones...</p>
                </div>
            </div>
        </div>
        
        <!-- Modal: Mi Historial -->
        <div id="modal-mi-historial" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
            <div class="modal-content" style="background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid #E5E7EB;">
                    <h3 style="color: #333; margin: 0;">
                        <i class="fas fa-history" style="color: #667eea;"></i> 
                        Mi Historial en el Foro
                    </h3>
                    <button onclick="cerrarHistorialForo()" class="close-btn" style="background: none; border: none; font-size: 28px; color: #666; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">
                        &times;
                    </button>
                </div>
                
                <!-- Tabs del historial -->
                <div class="historial-tabs" style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid #E5E7EB;">
                    <button class="historial-tab-btn active" data-tab="mis-posts" onclick="cambiarTabHistorial('mis-posts')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid #667eea; color: #667eea; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        <i class="fas fa-file-alt"></i> Mis Publicaciones
                    </button>
                    <button class="historial-tab-btn" data-tab="vistos" onclick="cambiarTabHistorial('vistos')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        <i class="fas fa-eye"></i> Vistos
                    </button>
                    <button class="historial-tab-btn" data-tab="respuestas" onclick="cambiarTabHistorial('respuestas')" style="padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        <i class="fas fa-reply"></i> Respuestas
                    </button>
                </div>
                
                <!-- Contenido de tabs -->
                <div id="historial-mis-posts" class="historial-tab-content" style="display: block;">
                    <div id="mi-historial-foro-lista">
                        <div class="empty-state" style="text-align: center; padding: 40px; color: #64748b;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>Cargando tus publicaciones...</p>
                        </div>
                    </div>
                </div>
                
                <div id="historial-vistos" class="historial-tab-content" style="display: none;">
                    <div id="historial-vistos-lista">
                        <div class="empty-state" style="text-align: center; padding: 40px; color: #64748b;">
                            <i class="fas fa-eye" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>A√∫n no has visto ninguna publicaci√≥n</p>
                        </div>
                    </div>
                </div>
                
                <div id="historial-respuestas" class="historial-tab-content" style="display: none;">
                    <div id="historial-respuestas-lista">
                        <div class="empty-state" style="text-align: center; padding: 40px; color: #64748b;">
                            <i class="fas fa-reply" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>A√∫n no has respondido a ninguna publicaci√≥n</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Secci√≥n para Reportar Vendedores Problem√°ticos -->
        <div class="reportar-section">
            <h4><i class="fas fa-flag"></i> Sistema de Reportes: Reportar Vendedores Problem√°ticos</h4>
            <p style="color: #666; margin-bottom: 20px;">Reporta vendedores que no cumplan con sus compromisos, vendan productos falsos o tengan mal comportamiento. Con 3+ reportes de diferentes compradores, el administrador proceder√° a tomar medidas. Tambi√©n puedes bloquear vendedores individualmente.</p>
            
            <div class="reportar-form">
                <div>
                    <label>Nombre del Vendedor/Tienda:</label>
                    <input type="text" id="nombreVendedor" placeholder="Nombre de la tienda o vendedor">
                </div>
                
                <div>
                    <label>Email o Tel√©fono del Vendedor:</label>
                    <input type="text" id="contactoVendedor" placeholder="Email o n√∫mero de tel√©fono del vendedor">
                </div>
                
                <div>
                    <label>Tipo de Problema:</label>
                    <select id="tipoProblema">
                        <option value="">Selecciona el tipo de problema</option>
                        <option value="producto-falso">Producto falso o de mala calidad</option>
                        <option value="no-entrega">No entreg√≥ el producto</option>
                        <option value="estafa">Intent√≥ estafar</option>
                        <option value="comportamiento-inadecuado">Comportamiento inadecuado</option>
                        <option value="no-responde">No responde mensajes</option>
                        <option value="cobro-extra">Cobr√≥ m√°s de lo acordado</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
                
                <div>
                    <label>Descripci√≥n del Problema:</label>
                    <textarea id="descripcionProblema" placeholder="Describe detalladamente qu√© pas√≥, cu√°ndo y c√≥mo..."></textarea>
                </div>
                
                <div>
                    <label>Evidencia (Capturas de pantalla):</label>
                    <input type="file" id="evidencia" accept="image/*,.pdf,.doc,.docx" multiple style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem; font-family: inherit;">
                    <small style="color: #666; font-size: 0.8rem;">Puedes subir m√∫ltiples archivos: im√°genes, PDFs o documentos</small>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button class="btn-reportar" onclick="reportarVendedorProblematico()">
                        <i class="fas fa-flag"></i> Reportar Vendedor
                    </button>
                    <button class="btn-bloquear" onclick="bloquearVendedorIndividual()">
                        <i class="fas fa-user-slash"></i> Bloquear Individualmente
                    </button>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="lista-reportar">
                    <h5><i class="fas fa-flag"></i> Vendedores Reportados (Esperando Revisi√≥n)</h5>
                    <p style="color: #666; font-size: 0.85rem; margin-bottom: 15px; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                        üí° <strong>¬øHas tenido una experiencia similar?</strong> Puedes responder a estos reportes para ayudar a otros compradores.
                    </p>
                    <div id="listaVendedoresReportados">
                        <div class="no-reportes">
                            <i class="fas fa-shield-alt" style="font-size: 2rem; color: #10B981; margin-bottom: 10px;"></i>
                            <p>¬°Excelente! No hay reportes pendientes.</p>
                            <small>Mantengamos esta comunidad limpia y segura para todos.</small>
                        </div>
                    </div>
                </div>
                
                <div class="lista-reportar">
                    <h5><i class="fas fa-user-slash"></i> Vendedores Bloqueados (Solo Tuyos)</h5>
                    <div id="listaVendedoresBloqueados">
                        <div class="no-reportes">
                            <i class="fas fa-user-check" style="font-size: 2rem; color: #8B5CF6; margin-bottom: 10px;"></i>
                            <p>No has bloqueado ning√∫n vendedor.</p>
                            <small>Los bloqueos son personales y solo te afectan a ti.</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Secci√≥n de consejos para compradores -->
        <div style="background: white; border-radius: 0; padding: 20px; margin-bottom: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h4 style="color: #333; margin-bottom: 20px;"><i class="fas fa-lightbulb"></i> Consejos para Compradores Seguros</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: #F0F9FF; padding: 15px; border-radius: 10px; border-left: 4px solid #3B82F6;">
                    <h6 style="color: #1E40AF; margin-bottom: 10px;"><i class="fas fa-search"></i> Antes de Comprar</h6>
                    <ul style="color: #1E40AF; margin: 0; padding-left: 20px; font-size: 0.9rem;">
                        <li>Verifica las fotos del producto</li>
                        <li>Lee las descripciones completas</li>
                        <li>Revisa las rese√±as de otros compradores</li>
                        <li>Confirma el precio y forma de pago</li>
                    </ul>
                </div>
                
                <div style="background: #F0FDF4; padding: 15px; border-radius: 10px; border-left: 4px solid #10B981;">
                    <h6 style="color: #059669; margin-bottom: 10px;"><i class="fas fa-handshake"></i> Durante la Compra</h6>
                    <ul style="color: #059669; margin: 0; padding-left: 20px; font-size: 0.9rem;">
                        <li>Pide capturas de pantalla del producto</li>
                        <li>Confirma tiempos de entrega</li>
                        <li>Guarda todas las conversaciones</li>
                        <li>Usa m√©todos de pago seguros</li>
                    </ul>
                </div>
                
                <div style="background: #FEF3C7; padding: 15px; border-radius: 10px; border-left: 4px solid #F59E0B;">
                    <h6 style="color: #92400E; margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> Si Algo Sale Mal</h6>
                    <ul style="color: #92400E; margin: 0; padding-left: 20px; font-size: 0.9rem;">
                        <li>Reporta inmediatamente el problema</li>
                        <li>Proporciona evidencia (capturas, chats)</li>
                        <li>Bloquea al vendedor si es necesario</li>
                        <li>Comparte tu experiencia con la comunidad</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ===== SISTEMA DE REPORTAR VENDEDORES PROBLEM√ÅTICOS =====
        
        // Funci√≥n para convertir archivos a base64
        function convertirArchivosABase64(archivos) {
            return new Promise((resolve, reject) => {
                const archivosBase64 = [];
                let archivosProcesados = 0;
                
                if (archivos.length === 0) {
                    resolve([]);
                    return;
                }
                
                Array.from(archivos).forEach((archivo, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        archivosBase64.push({
                            nombre: archivo.name,
                            tipo: archivo.type,
                            tama√±o: archivo.size,
                            contenido: e.target.result
                        });
                        archivosProcesados++;
                        
                        if (archivosProcesados === archivos.length) {
                            resolve(archivosBase64);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(archivo);
                });
            });
        }
        
        // Funci√≥n para reportar un vendedor problem√°tico
        async function reportarVendedorProblematico() {
            const nombre = document.getElementById('nombreVendedor').value.trim();
            const contacto = document.getElementById('contactoVendedor').value.trim();
            const tipoProblema = document.getElementById('tipoProblema').value;
            const descripcion = document.getElementById('descripcionProblema').value.trim();
            const archivosEvidencia = document.getElementById('evidencia').files;
            
            // Validaciones
            if (!nombre || !contacto || !tipoProblema || !descripcion) {
                alert('‚ö†Ô∏è Por favor completa todos los campos obligatorios.');
                return;
            }
            
            if (descripcion.length < 20) {
                alert('‚ö†Ô∏è La descripci√≥n debe tener al menos 20 caracteres para ser v√°lida.');
                return;
            }
            
            // Validar que haya evidencia
            if (archivosEvidencia.length === 0) {
                alert('‚ö†Ô∏è Por favor sube al menos una captura de pantalla o evidencia.');
                return;
            }
            
            // Confirmar reporte
            const confirmar = confirm(`¬øEst√°s seguro de reportar a "${nombre}"?\n\nEsto enviar√° el reporte al administrador para revisi√≥n. Con 3+ reportes de diferentes compradores, se proceder√° a tomar medidas.`);
            if (!confirmar) return;
            
            // Mostrar loading
            mostrarNotificacion('üì§ Procesando evidencia...', 'info');
            
            try {
                // Convertir archivos a base64
                const evidenciasBase64 = await convertirArchivosABase64(archivosEvidencia);
                
                // Crear objeto del reporte
                const reporte = {
                    id: Date.now(),
                    nombre: nombre,
                    contacto: contacto,
                    tipoProblema: tipoProblema,
                    descripcion: descripcion,
                    evidencia: evidenciasBase64,
                    fecha: new Date().toLocaleDateString('es-ES'),
                    reportadoPor: 'Comprador Actual', // En una implementaci√≥n real ser√≠a el usuario logueado
                    estado: 'pendiente',
                    compradorId: 'comprador_demo', // ID √∫nico del comprador
                    numeroReportes: 1 // Contador de reportes para este vendedor
                };
                
                // Verificar si ya hay reportes para este vendedor
                let reportes = JSON.parse(localStorage.getItem('vendedoresReportados') || '[]');
                const reporteExistente = reportes.find(r => r.contacto === contacto);
                
                if (reporteExistente) {
                    reporte.numeroReportes = reporteExistente.numeroReportes + 1;
                    // Reemplazar el reporte anterior
                    reportes = reportes.filter(r => r.contacto !== contacto);
                }
                
                reportes.push(reporte);
                localStorage.setItem('vendedoresReportados', JSON.stringify(reportes));
                
                // Limpiar formulario
                document.getElementById('nombreVendedor').value = '';
                document.getElementById('contactoVendedor').value = '';
                document.getElementById('tipoProblema').value = '';
                document.getElementById('descripcionProblema').value = '';
                document.getElementById('evidencia').value = '';
                
                // Actualizar listas
                mostrarVendedoresReportados();
                mostrarVendedoresBloqueados();
                
                // Mostrar confirmaci√≥n
                mostrarNotificacion(`‚úÖ Reporte enviado al administrador. Total de reportes para este vendedor: ${reporte.numeroReportes}`, 'success');
                
            } catch (error) {
                console.error('Error procesando archivos:', error);
                mostrarNotificacion('‚ùå Error al procesar la evidencia. Intenta nuevamente.', 'error');
            }
        }
        
        // Funci√≥n para mostrar la lista de vendedores reportados
        function mostrarVendedoresReportados() {
            const reportes = JSON.parse(localStorage.getItem('vendedoresReportados') || '[]');
            const container = document.getElementById('listaVendedoresReportados');
            
            if (reportes.length === 0) {
                container.innerHTML = `
                    <div class="no-reportes">
                        <i class="fas fa-shield-alt" style="font-size: 2rem; color: #10B981; margin-bottom: 10px;"></i>
                        <p>¬°Excelente! No hay reportes pendientes.</p>
                        <small>Mantengamos esta comunidad limpia y segura para todos.</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            reportes.forEach(reporte => {
                const motivoTexto = {
                    'producto-falso': 'Producto falso',
                    'no-entrega': 'No entreg√≥',
                    'estafa': 'Estafa',
                    'comportamiento-inadecuado': 'Comportamiento inadecuado',
                    'no-responde': 'No responde',
                    'cobro-extra': 'Cobr√≥ extra',
                    'otro': 'Otro motivo'
                }[reporte.tipoProblema] || reporte.tipoProblema;
                
                html += `
                    <div class="item-reportar">
                        <div class="info">
                            <h6>${reporte.nombre}</h6>
                            <p><strong>Contacto:</strong> ${reporte.contacto}</p>
                            <p><strong>Motivo:</strong> <span class="motivo">${motivoTexto}</span></p>
                            <p><strong>Fecha:</strong> ${reporte.fecha}</p>
                            <p><strong>Estado:</strong> <span style="color: #F59E0B; font-weight: 600;">‚è≥ PENDIENTE</span></p>
                            <p><strong>Reportes:</strong> <span style="color: #DC2626; font-weight: 600;">${reporte.numeroReportes || 1} reporte(s)</span></p>
                            ${reporte.evidencia && reporte.evidencia.length > 0 ? `<p><strong>Evidencia:</strong> ${reporte.evidencia.length} archivo(s) subido(s)</p>` : ''}
                            <p><strong>Descripci√≥n:</strong> ${reporte.descripcion}</p>
                        </div>
                        <div class="actions" style="margin-top: 10px;">
                            <button class="btn btn-sm btn-info" onclick="responderReporte(${reporte.id})" style="background: #17a2b8; border-color: #17a2b8; margin-right: 5px;">
                                <i class="fas fa-comment-dots"></i> Responder
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="bloquearVendedorIndividual('${reporte.nombre}', '${reporte.contacto}')">
                                <i class="fas fa-user-slash"></i> Bloquear
                            </button>
                        </div>
                        ${reporte.respuestas && reporte.respuestas.length > 0 ? `
                            <div class="respuestas-reporte" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                                <h6 style="color: #17a2b8; margin-bottom: 10px;"><i class="fas fa-comments"></i> Respuestas de la Comunidad (${reporte.respuestas.length}):</h6>
                                ${reporte.respuestas.map(respuesta => `
                                    <div class="respuesta-item" style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <strong style="color: #495057;">${respuesta.nombre}</strong>
                                            <small style="color: #6c757d;">${respuesta.fecha}</small>
                                        </div>
                                        <p style="margin: 0; color: #333;">${respuesta.mensaje}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Funci√≥n para mostrar la lista de vendedores bloqueados individualmente
        function mostrarVendedoresBloqueados() {
            const bloqueados = JSON.parse(localStorage.getItem('vendedoresBloqueados') || '[]');
            const container = document.getElementById('listaVendedoresBloqueados');
            
            if (bloqueados.length === 0) {
                container.innerHTML = `
                    <div class="no-reportes">
                        <i class="fas fa-user-check" style="font-size: 2rem; color: #8B5CF6; margin-bottom: 10px;"></i>
                        <p>No has bloqueado ning√∫n vendedor.</p>
                        <small>Los bloqueos son personales y solo te afectan a ti.</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            bloqueados.forEach(bloqueado => {
                html += `
                    <div class="item-reportar">
                        <div class="info">
                            <h6>${bloqueado.nombre}</h6>
                            <p><strong>Contacto:</strong> ${bloqueado.contacto}</p>
                            <p><strong>Fecha:</strong> ${bloqueado.fecha}</p>
                            <p><strong>Estado:</strong> <span style="color: #8B5CF6; font-weight: 600;">üö´ BLOQUEADO</span></p>
                        </div>
                        <button class="btn-desbloquear" onclick="desbloquearVendedor(${bloqueado.id})">
                            <i class="fas fa-unlock"></i> Desbloquear
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Funci√≥n para bloquear un vendedor individualmente
        function bloquearVendedorIndividual() {
            const nombre = document.getElementById('nombreVendedor').value.trim();
            const contacto = document.getElementById('contactoVendedor').value.trim();
            
            if (!nombre || !contacto) {
                alert('‚ö†Ô∏è Por favor completa al menos el nombre y contacto para bloquear.');
                return;
            }
            
            const confirmar = confirm(`¬øEst√°s seguro de bloquear a "${nombre}"?\n\nEste bloqueo es personal y solo te afecta a ti.`);
            if (!confirmar) return;
            
            // Crear objeto del bloqueo
            const bloqueado = {
                id: Date.now(),
                nombre: nombre,
                contacto: contacto,
                fecha: new Date().toLocaleDateString('es-ES'),
                compradorId: 'comprador_demo' // ID √∫nico del comprador
            };
            
            // Guardar en localStorage (bloqueos individuales)
            let bloqueados = JSON.parse(localStorage.getItem('vendedoresBloqueados') || '[]');
            bloqueados.push(bloqueado);
            localStorage.setItem('vendedoresBloqueados', JSON.stringify(bloqueados));
            
            // Actualizar lista
            mostrarVendedoresBloqueados();
            
            // Mostrar confirmaci√≥n
            mostrarNotificacion('‚úÖ Vendedor bloqueado individualmente. Solo te afecta a ti.', 'success');
        }
        
        // Funci√≥n para desbloquear un vendedor
        function desbloquearVendedor(id) {
            const confirmar = confirm('¬øEst√°s seguro de desbloquear a este vendedor?');
            if (!confirmar) return;
            
            let bloqueados = JSON.parse(localStorage.getItem('vendedoresBloqueados') || '[]');
            bloqueados = bloqueados.filter(bloqueado => bloqueado.id !== id);
            localStorage.setItem('vendedoresBloqueados', JSON.stringify(bloqueados));
            
            mostrarVendedoresBloqueados();
            mostrarNotificacion('‚úÖ Vendedor desbloqueado exitosamente.', 'success');
        }
        
        // Funci√≥n para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo = 'info') {
            // Crear elemento de notificaci√≥n
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${tipo === 'success' ? '#10B981' : tipo === 'error' ? '#EF4444' : '#3B82F6'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                max-width: 400px;
            `;
            notificacion.textContent = mensaje;
            
            document.body.appendChild(notificacion);
            
            // Remover despu√©s de 4 segundos
            setTimeout(() => {
                if (notificacion.parentNode) {
                    notificacion.parentNode.removeChild(notificacion);
                }
            }, 4000);
        }
        
        // ===== SISTEMA DE RESPUESTAS A REPORTES =====
        
        // Funci√≥n para responder a un reporte
        function responderReporte(reporteId) {
            const nombre = prompt('Tu nombre (opcional):') || 'Comprador An√≥nimo';
            const mensaje = prompt('Tu respuesta o experiencia similar:');
            
            if (!mensaje || mensaje.trim().length < 5) {
                alert('‚ö†Ô∏è Por favor escribe una respuesta de al menos 5 caracteres.');
                return;
            }
            
            const respuesta = {
                id: Date.now(),
                reporteId: reporteId,
                nombre: nombre.trim(),
                mensaje: mensaje.trim(),
                fecha: new Date().toLocaleDateString('es-ES'),
                hora: new Date().toLocaleTimeString('es-ES')
            };
            
            // Obtener reportes existentes
            let reportes = JSON.parse(localStorage.getItem('vendedoresReportados') || '[]');
            const reporteIndex = reportes.findIndex(r => r.id === reporteId);
            
            if (reporteIndex !== -1) {
                // Agregar respuesta al reporte
                if (!reportes[reporteIndex].respuestas) {
                    reportes[reporteIndex].respuestas = [];
                }
                reportes[reporteIndex].respuestas.push(respuesta);
                
                // Guardar actualizaci√≥n
                localStorage.setItem('vendedoresReportados', JSON.stringify(reportes));
                
                // Actualizar vista
                mostrarVendedoresReportados();
                
                mostrarNotificacion('‚úÖ Respuesta agregada. Gracias por ayudar a la comunidad.', 'success');
            } else {
                mostrarNotificacion('‚ùå Error: No se encontr√≥ el reporte.', 'error');
            }
        }
        
        // Inicializar comunidad
        document.addEventListener('DOMContentLoaded', () => {
            // Agregar algunos datos de ejemplo si no existen
            if (!localStorage.getItem('vendedores_reportados')) {
                const ejemplos = [
                    {
                        id: 1,
                        vendedor: 'vendedor_ejemplo@email.com',
                        nombre: 'Tienda Ejemplo',
                        motivo: 'Producto defectuoso',
                        descripcion: 'El producto lleg√≥ roto y no responden los mensajes',
                        evidencia: null,
                        numeroReportes: 2,
                        fecha: new Date().toISOString()
                    }
                ];
                localStorage.setItem('vendedores_reportados', JSON.stringify(ejemplos));
            }
            
            // Mostrar listas al cargar
            mostrarVendedoresReportados();
            mostrarVendedoresBloqueados();
        });
    </script>
    
    <script src="js/cumpleaneros-compradores.js"></script>
    <script src="js/cumpleaneros-resumen.js"></script>
    <!-- Sistema de Alertas de Emergencia Global -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="auth/supabase-config.js"></script>
    <script>
        // Inicializar Supabase al cargar
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof initSupabase === 'function') {
                window.SUPABASE_CLIENT = initSupabase();
                console.log('‚úÖ Supabase inicializado en panel de compradores');
            } else {
                console.warn('‚ö†Ô∏è initSupabase no est√° disponible');
            }
        });
    </script>
    <script src="js/sistema-alertas-comunidades.js"></script>
    <!-- Sistema de Check-in Autom√°tico de Emergencias -->
    <script src="js/sistema-checkin-emergencias.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (typeof SistemaAlertasComunidades !== 'undefined') {
                    window.alertasGlobal = new SistemaAlertasComunidades('global');
                }
            }, 500);
        });
    </script>
    
    <!-- Sistema de Foro para Comunidad -->
    <script src="js/sistema-foro-comunidades.js"></script>
    <script>
        // Inicializar sistema de foro
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (typeof SistemaForoComunidades !== 'undefined') {
                    window.foroComunidadCompradores = new SistemaForoComunidades('compradores');
                    console.log('‚úÖ Sistema de foro inicializado para compradores');
                }
            }, 1000);
        });
        
        // Asegurar que los modales est√©n cerrados al cargar la p√°gina
        function cerrarModalesAlCargar() {
            const modalHistorial = document.getElementById('modal-mi-historial');
            if (modalHistorial) {
                modalHistorial.style.display = 'none';
            }
        }
        
        // Ejecutar inmediatamente y tambi√©n en DOMContentLoaded
        cerrarModalesAlCargar();
        document.addEventListener('DOMContentLoaded', cerrarModalesAlCargar);
        window.addEventListener('load', cerrarModalesAlCargar);
        
        // Funci√≥n para cerrar modal de crear post (mantenida por compatibilidad, aunque el modal ya no existe)
        function cerrarModalCrearPost() {
            const modal = document.getElementById('modal-crear-post');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Funciones para historial
        function mostrarHistorialForo() {
            const modal = document.getElementById('modal-mi-historial');
            if (modal) {
                modal.style.display = 'flex';
                cambiarTabHistorial('mis-posts');
                if (window.foroComunidadCompradores) {
                    window.foroComunidadCompradores.cargarMiHistorial();
                }
            }
        }
        
        function cerrarHistorialForo() {
            const modal = document.getElementById('modal-mi-historial');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function cambiarTabHistorial(tabId) {
            // Verificar que el modal est√© abierto antes de cargar contenido
            const modal = document.getElementById('modal-mi-historial');
            if (!modal || (modal.style.display !== 'flex' && modal.style.display !== 'block')) {
                // El modal no est√° abierto, no cargar contenido
                return;
            }
            
            // Ocultar todos los contenidos
            document.querySelectorAll('.historial-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Desactivar todos los botones
            document.querySelectorAll('.historial-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottomColor = 'transparent';
                btn.style.color = '#666';
            });
            
            // Mostrar contenido seleccionado
            const content = document.getElementById(`historial-${tabId}`);
            if (content) {
                content.style.display = 'block';
            }
            
            // Activar bot√≥n seleccionado
            const btn = document.querySelector(`[data-tab="${tabId}"]`);
            if (btn) {
                btn.classList.add('active');
                btn.style.borderBottomColor = '#667eea';
                btn.style.color = '#667eea';
            }
            
            // Cargar contenido seg√∫n tab (solo si el modal est√° abierto)
            if (window.foroComunidadCompradores && modal.style.display === 'flex') {
                if (tabId === 'mis-posts') {
                    window.foroComunidadCompradores.cargarMiHistorial();
                } else if (tabId === 'vistos') {
                    window.foroComunidadCompradores.cargarPostsVistos();
                } else if (tabId === 'respuestas') {
                    window.foroComunidadCompradores.cargarPostsConRespuestas();
                }
            }
        }
    </script>
    
    <!-- Widget de Chat de Email - Brevo -->
    <script src="js/widget-brevo-chat.js"></script>
</body>
</html>
