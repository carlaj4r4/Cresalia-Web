<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Panel - Cresalia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #7C3AED;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #6D28D9;
        }
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Test Admin Panel - Cresalia</h1>
        <p>Esta pÃ¡gina te permite probar las funciones del admin panel sin necesidad de autenticaciÃ³n.</p>
        
        <h2>ğŸ”§ Funciones de Productos</h2>
        <button class="test-button" onclick="testCargarProductos()">ğŸ“¦ Cargar Productos</button>
        <button class="test-button" onclick="testAgregarProducto()">â• Agregar Producto</button>
        <button class="test-button" onclick="testEliminarProducto()">ğŸ—‘ï¸ Eliminar Producto</button>
        <button class="test-button" onclick="testMostrarProductos()">ğŸ‘ï¸ Mostrar Productos</button>
        
        <h2>ğŸ”— ConexiÃ³n Backend</h2>
        <button class="test-button" onclick="testConexionBackend()">ğŸŒ Verificar ConexiÃ³n</button>
        <button class="test-button" onclick="testBackendConnection()">ğŸ”Œ Test Backend Connection</button>
        
        <h2>ğŸ“Š Datos</h2>
        <button class="test-button" onclick="testExportarDatos()">ğŸ’¾ Exportar Datos</button>
        <button class="test-button" onclick="testLimpiarDatos()">ğŸ§¹ Limpiar Datos</button>
        
        <div id="testResults"></div>
        
        <h2>ğŸ“‹ Estado Actual</h2>
        <div id="currentState" class="test-result">
            <strong>Productos:</strong> <span id="productCount">0</span><br>
            <strong>Servicios:</strong> <span id="serviceCount">0</span><br>
            <strong>ConexiÃ³n Backend:</strong> <span id="backendStatus">Desconocido</span>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="js/elegant-notifications.js"></script>
    <script src="js/admin-backend-connection.js"></script>
    <script src="js/admin-panel-functions.js"></script>
    
    <script>
        // Variables globales para testing
        let testProductos = [];
        
        function logTest(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
            
            // Limitar a 10 resultados
            const results = resultsDiv.querySelectorAll('.test-result');
            if (results.length > 10) {
                results[results.length - 1].remove();
            }
        }
        
        function updateCurrentState() {
            document.getElementById('productCount').textContent = testProductos.length;
            document.getElementById('serviceCount').textContent = '0'; // Por ahora
            document.getElementById('backendStatus').textContent = window.adminBackend ? 'Conectado' : 'Desconectado';
        }
        
        // Tests
        function testCargarProductos() {
            logTest('ğŸ”„ Cargando productos...', 'info');
            cargarProductos().then(() => {
                testProductos = productos;
                logTest(`âœ… Productos cargados: ${productos.length}`, 'success');
                updateCurrentState();
            }).catch(error => {
                logTest(`âŒ Error cargando productos: ${error.message}`, 'error');
            });
        }
        
        function testAgregarProducto() {
            const nuevoProducto = {
                id: Date.now(),
                nombre: `Producto Test ${Date.now()}`,
                descripcion: 'Producto creado desde test',
                precio: Math.floor(Math.random() * 1000) + 100,
                stock: Math.floor(Math.random() * 50),
                categoria: 'Test',
                activo: 1
            };
            
            logTest(`â• Agregando producto: ${nuevoProducto.nombre}`, 'info');
            
            if (window.adminBackend) {
                window.adminBackend.crearProducto(nuevoProducto).then(response => {
                    if (response && response.success) {
                        logTest(`âœ… Producto creado exitosamente`, 'success');
                        testCargarProductos(); // Recargar
                    } else {
                        logTest(`âŒ Error creando producto: ${response?.error || 'Error desconocido'}`, 'error');
                    }
                }).catch(error => {
                    logTest(`âŒ Error en backend: ${error.message}`, 'error');
                });
            } else {
                // Modo offline
                testProductos.push(nuevoProducto);
                productos = testProductos;
                mostrarProductos();
                logTest(`âœ… Producto agregado (modo offline): ${nuevoProducto.nombre}`, 'success');
                updateCurrentState();
            }
        }
        
        function testEliminarProducto() {
            if (testProductos.length === 0) {
                logTest('âš ï¸ No hay productos para eliminar', 'warning');
                return;
            }
            
            const producto = testProductos[0];
            logTest(`ğŸ—‘ï¸ Eliminando producto: ${producto.nombre}`, 'info');
            
            if (window.adminBackend) {
                window.adminBackend.eliminarProducto(producto.id).then(response => {
                    if (response && response.success) {
                        logTest(`âœ… Producto eliminado exitosamente`, 'success');
                        testCargarProductos(); // Recargar
                    } else {
                        logTest(`âŒ Error eliminando producto: ${response?.error || 'Error desconocido'}`, 'error');
                    }
                }).catch(error => {
                    logTest(`âŒ Error en backend: ${error.message}`, 'error');
                });
            } else {
                // Modo offline
                testProductos = testProductos.filter(p => p.id !== producto.id);
                productos = testProductos;
                mostrarProductos();
                logTest(`âœ… Producto eliminado (modo offline): ${producto.nombre}`, 'success');
                updateCurrentState();
            }
        }
        
        function testMostrarProductos() {
            logTest(`ğŸ‘ï¸ Mostrando ${testProductos.length} productos`, 'info');
            mostrarProductos();
            
            if (testProductos.length > 0) {
                testProductos.forEach((producto, index) => {
                    logTest(`${index + 1}. ${producto.nombre} - $${producto.precio}`, 'info');
                });
            }
        }
        
        function testConexionBackend() {
            logTest('ğŸŒ Verificando conexiÃ³n con backend...', 'info');
            
            if (window.adminBackend) {
                window.adminBackend.verificarConexion().then(conectado => {
                    if (conectado) {
                        logTest('âœ… Backend conectado correctamente', 'success');
                    } else {
                        logTest('âš ï¸ Backend no disponible', 'warning');
                    }
                    updateCurrentState();
                }).catch(error => {
                    logTest(`âŒ Error verificando conexiÃ³n: ${error.message}`, 'error');
                });
            } else {
                logTest('âš ï¸ AdminBackend no estÃ¡ disponible', 'warning');
            }
        }
        
        function testBackendConnection() {
            logTest('ğŸ”Œ Probando AdminBackendConnection...', 'info');
            
            if (window.adminBackend) {
                logTest(`âœ… AdminBackendConnection disponible`, 'success');
                logTest(`ğŸ“¡ Base URL: ${window.adminBackend.baseURL}`, 'info');
                logTest(`ğŸª Tenant actual: ${window.adminBackend.currentTenant}`, 'info');
                logTest(`ğŸ”‘ Token: ${window.adminBackend.authToken ? 'Presente' : 'No presente'}`, 'info');
            } else {
                logTest('âŒ AdminBackendConnection no estÃ¡ disponible', 'error');
            }
        }
        
        function testExportarDatos() {
            const datos = {
                productos: testProductos,
                servicios: [],
                ofertas: [],
                categorias: [],
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `cresalia-test-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            logTest('ğŸ’¾ Datos exportados correctamente', 'success');
        }
        
        function testLimpiarDatos() {
            testProductos = [];
            productos = [];
            mostrarProductos();
            updateCurrentState();
            logTest('ğŸ§¹ Datos limpiados', 'info');
        }
        
        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            logTest('ğŸš€ Test Admin Panel iniciado', 'info');
            updateCurrentState();
            
            // Verificar conexiÃ³n automÃ¡ticamente
            setTimeout(testConexionBackend, 1000);
        });
    </script>
</body>
</html>























