<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Tienda - Panel de Administraci√≥n</title>
    
    <!-- Meta tags para seguridad -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Panel de administraci√≥n exclusivo">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://sdk.mercadopago.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https: blob:; connect-src 'self' https:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../../assets/logo/logo-cresalia.png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos personalizados -->
    <style>
        :root {
            --primary-color: #7C3AED;
            --secondary-color: #EC4899;
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
            --light-color: #F8FAFC;
            --dark-color: #1E293B;
            --border-radius: 8px;
            --box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar-header h3 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: #6B7280;
            font-size: 0.9rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--dark-color);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .nav-link:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary-color);
            transform: translateX(5px);
        }

        .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
            transition: var(--transition);
        }

        .main-content.expanded {
            margin-left: 80px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }

        .header h1 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: #6B7280;
            margin-bottom: 0;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            margin: 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 22px;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6B7280;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .modal-body {
            padding: 15px 20px;
        }

        /* Modales m√°s compactos */
        .modal-content.compact {
            max-width: 400px;
            width: 85%;
        }

        .modal-content.compact .modal-header {
            padding: 12px 15px;
        }

        .modal-content.compact .modal-body {
            padding: 12px 15px;
        }

        .modal-content.compact .modal-title {
            font-size: 1.1rem;
        }

        .modal-content.compact .form-group {
            margin-bottom: 12px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: white;
            transition: var(--transition);
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .table th {
            background: rgba(124, 58, 237, 0.1);
            font-weight: 600;
            color: var(--primary-color);
        }

        .table tbody tr:hover {
            background: rgba(124, 58, 237, 0.05);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .alert {
            padding: 16px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: none;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
            border-left: 4px solid var(--info-color);
        }

        .toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .toggle-sidebar:hover {
            transform: scale(1.1);
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .modal-content {
                max-width: 95%;
                width: 95%;
                margin: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }

            .content-section {
                padding: 20px;
            }

            .modal-body {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Toggle Sidebar Button -->
    <button class="toggle-sidebar" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Mi Tienda</h3>
                <p>Panel de Administraci√≥n</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="mostrarSeccion('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('productos')">
                        <i class="fas fa-box"></i>
                        <span>Productos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('servicios')">
                        <i class="fas fa-concierge-bell"></i>
                        <span>Servicios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('turnos')">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Turnos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('ventas')">
                        <i class="fas fa-chart-line"></i>
                        <span>Ventas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('ofertas')">
                        <i class="fas fa-tags"></i>
                        <span>Ofertas</span>
                    </a>
                </li>
                <li class="nav-item" id="menuBienestar" style="display: none;">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('bienestar')">
                        <i class="fas fa-heart"></i>
                        <span>Bienestar</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('chatbot')">
                        <i class="fas fa-robot"></i>
                        <span>Chatbot IA</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('diseno')">
                        <i class="fas fa-palette"></i>
                        <span>Dise√±o de P√°gina</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('metricas')">
                        <i class="fas fa-chart-bar"></i>
                        <span>M√©tricas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('feedbacks')">
                        <i class="fas fa-comments"></i>
                        <span>Feedbacks</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('soporte')">
                        <i class="fas fa-life-ring"></i>
                        <span>Soporte</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('suscripciones')">
                        <i class="fas fa-crown"></i>
                        <span>Suscripciones</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('historial')">
                        <i class="fas fa-history"></i>
                        <span>Historial</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="mostrarSeccion('configuracion')">
                        <i class="fas fa-cog"></i>
                        <span>Configuraci√≥n</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <h1 id="headerTitle">Dashboard</h1>
                <p id="headerDescription">Bienvenido a tu panel de administraci√≥n</p>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalProductos">0</h3>
                        <p>Productos</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalServicios">0</h3>
                        <p>Servicios</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalVentas">0</h3>
                        <p>Ventas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalIngresos">$0</h3>
                        <p>Ingresos</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h3>Acciones R√°pidas</h3>
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" onclick="abrirModal('modalProducto')">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                                <button class="btn btn-primary" onclick="abrirModal('modalServicio')">
                                    <i class="fas fa-plus"></i> Agregar Servicio
                                </button>
                                <button class="btn btn-primary" onclick="abrirModal('modalTurno')">
                                    <i class="fas fa-calendar-plus"></i> Configurar Turnos
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h3>Ventas Recientes</h3>
                            <div id="ventasRecientes">
                                <p class="text-muted">No hay ventas recientes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Productos Section -->
            <div id="productos" class="content-section hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Productos</h3>
                    <button class="btn btn-primary" onclick="abrirModal('modalProducto')">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </button>
                </div>
                <div id="listaProductos">
                    <p class="text-muted">No hay productos registrados</p>
                </div>
            </div>

            <!-- Servicios Section -->
            <div id="servicios" class="content-section hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Servicios</h3>
                    <button class="btn btn-primary" onclick="abrirModal('modalServicio')">
                        <i class="fas fa-plus"></i> Agregar Servicio
                    </button>
                </div>
                <div id="listaServicios">
                    <p class="text-muted">No hay servicios registrados</p>
                </div>
            </div>

            <!-- Turnos Section -->
            <div id="turnos" class="content-section hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Turnos</h3>
                    <button class="btn btn-primary" onclick="abrirModal('modalTurno')">
                        <i class="fas fa-cog"></i> Configurar Turnos
                    </button>
                </div>
                <div id="configuracionTurnos">
                    <p class="text-muted">Configura tus horarios de atenci√≥n</p>
                </div>
            </div>

            <!-- Ventas Section -->
            <div id="ventas" class="content-section hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Ventas</h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="abrirModal('modalVenta')">
                            <i class="fas fa-plus"></i> Nueva Venta
                        </button>
                        <button class="btn btn-secondary" onclick="sistemaReportes.exportarDatos()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                </div>
                
                <!-- Filtros de Ventas -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label">Filtrar por fecha</label>
                            <input type="date" class="form-control" id="filtroFechaVentas" onchange="filtrarVentas()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label">Filtrar por cliente</label>
                            <input type="text" class="form-control" id="filtroClienteVentas" placeholder="Nombre del cliente" onkeyup="filtrarVentas()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label">Filtrar por estado</label>
                            <select class="form-select" id="filtroEstadoVentas" onchange="filtrarVentas()">
                                <option value="">Todos</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="completada">Completada</option>
                                <option value="cancelada">Cancelada</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="form-label">Acciones</label>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="exportarVentas()">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="limpiarFiltrosVentas()">
                                    <i class="fas fa-times"></i> Limpiar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="listaVentas">
                    <p class="text-muted">No hay ventas registradas</p>
                </div>
                
                <!-- Estad√≠sticas de Ventas -->
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <h5>Total Ventas</h5>
                            <div class="h3 text-primary" id="totalVentas">$0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <h5>Ventas del Mes</h5>
                            <div class="h3 text-success" id="ventasMes">$0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <h5>Promedio por Venta</h5>
                            <div class="h3 text-info" id="promedioVenta">$0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <h5>Cantidad Ventas</h5>
                            <div class="h3 text-warning" id="cantidadVentas">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ofertas Section -->
            <div id="ofertas" class="content-section hidden">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3>Ofertas Especiales</h3>
                    <button class="btn btn-primary" onclick="abrirModal('modalOferta')">
                        <i class="fas fa-plus"></i> Crear Oferta
                    </button>
                </div>
                <div id="listaOfertas">
                    <p class="text-muted">No hay ofertas creadas</p>
                </div>
            </div>

            <!-- Bienestar Emocional Section -->
            <div id="bienestar" class="content-section hidden" style="display: none;">
                <h3>Sistema de Bienestar Emocional</h3>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>Disponible solo para usuarios nuevos</strong><br>
                    Este sistema est√° dise√±ado para apoyarte en tus primeros pasos como emprendedor.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h4>Estado de √Ånimo</h4>
                            <div class="btn-group d-flex" role="group">
                                <button class="btn btn-success" onclick="actualizarEstadoAnimo('feliz')">
                                    <i class="fas fa-smile"></i> Feliz
                                </button>
                                <button class="btn btn-warning" onclick="actualizarEstadoAnimo('neutral')">
                                    <i class="fas fa-meh"></i> Neutral
                                </button>
                                <button class="btn btn-danger" onclick="actualizarEstadoAnimo('triste')">
                                    <i class="fas fa-frown"></i> Triste
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h4>Consejos del D√≠a</h4>
                            <div id="consejoBienestar">
                                <p class="text-muted">Cargando consejo...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat con CRISLA (Carla) -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="content-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4>üíú Chat con CRISLA - Tu Soporte Emocional</h4>
                                <button class="btn btn-sm btn-primary" onclick="abrirModal('modalCrisla')" id="btnConfigurarCrisla" style="display: none;">
                                    <i class="fas fa-cog"></i> Configurar CRISLA
                                </button>
                            </div>
                            
                            <div id="chatCrislaContainer" style="height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: linear-gradient(135deg, #FDF2F8, #FCE7F3);">
                                <div class="chat-message crisla-message">
                                    <strong>üíú CRISLA:</strong> ¬°Hola! Soy CRISLA, tu soporte emocional. ¬øC√≥mo te sientes hoy? Estoy aqu√≠ para escucharte y apoyarte.
                                </div>
                            </div>
                            
                            <div class="input-group mt-3">
                                <input type="text" class="form-control" id="crislaInput" placeholder="Escribe a CRISLA...">
                                <button class="btn btn-primary" onclick="enviarMensajeCrisla()">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                            
                            <!-- Enlace al respaldo emocional -->
                            <div class="mt-3">
                                <a href="../../../crisla-respaldo-emocional.html" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-external-link-alt"></i> Acceder al Respaldo Emocional Completo
                                </a>
                            </div>
                            
                            <!-- Restricci√≥n de Plan para CRISLA -->
                            <div id="restriccionCrisla" class="alert alert-info mt-3">
                                <i class="fas fa-heart"></i> <strong>CRISLA disponible en todos los planes</strong><br>
                                <i class="fas fa-crown"></i> <strong>Planes Pagos:</strong> Personaliza las respuestas de CRISLA
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chatbot IA Section -->
            <div id="chatbot" class="content-section hidden">
                <h3>Chatbot IA - CRESALIA BOT</h3>
                <div class="row">
                    <div class="col-md-8">
                        <div class="content-section">
                            <div id="chatContainer" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px;">
                                <div class="chat-message bot-message">
                                    <strong>CRESALIA BOT:</strong> ¬°Hola! Soy tu asistente IA. ¬øEn qu√© puedo ayudarte hoy?
                                </div>
                            </div>
                            <div class="input-group mt-3">
                                <input type="text" class="form-control" id="chatInput" placeholder="Escribe tu mensaje...">
                                <button class="btn btn-primary" onclick="enviarMensaje()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section">
                            <h4>Configuraci√≥n del Bot</h4>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="botActivo" checked>
                                <label class="form-check-label" for="botActivo">
                                    Bot activo
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="respuestasAutomaticas" checked>
                                <label class="form-check-label" for="respuestasAutomaticas">
                                    Respuestas autom√°ticas
                                </label>
                            </div>
                            
                            <!-- Configuraci√≥n Avanzada del Bot (Solo Planes Pagos) -->
                            <div id="configuracionAvanzadaBot" class="mt-4" style="display: none;">
                                <h5>Personalizar Respuestas</h5>
                                <div class="form-group">
                                    <label class="form-label">Mensaje de Bienvenida</label>
                                    <textarea class="form-control" id="mensajeBienvenida" rows="2">¬°Hola! Soy tu asistente IA. ¬øEn qu√© puedo ayudarte hoy?</textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Respuesta por Defecto</label>
                                    <textarea class="form-control" id="respuestaDefecto" rows="2">Entiendo tu consulta. ¬øPodr√≠as ser m√°s espec√≠fico? Puedo ayudarte con productos, servicios, ventas, configuraci√≥n y m√°s.</textarea>
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="guardarConfiguracionBot()">Guardar Configuraci√≥n</button>
                            </div>
                            
                            <!-- Restricci√≥n de Plan -->
                            <div id="restriccionBot" class="alert alert-warning">
                                <i class="fas fa-crown"></i> <strong>Funci√≥n Premium</strong><br>
                                Personaliza tu chatbot con el Plan B√°sico o Premium
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Soporte Section -->
            <div id="soporte" class="content-section hidden">
                <h3>Soporte y Ayuda</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h4>Medios de Contacto</h4>
                            <form id="formContacto">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="email" placeholder="soporte@mitienda.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">WhatsApp</label>
                                    <input type="tel" class="form-control" name="whatsapp" placeholder="+54 9 11 1234-5678">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tel√©fono</label>
                                    <input type="tel" class="form-control" name="telefono" placeholder="+54 11 1234-5678">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Direcci√≥n</label>
                                    <textarea class="form-control" name="direccion" rows="3" placeholder="Direcci√≥n f√≠sica de la tienda"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Contacto</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4>Preguntas Frecuentes</h4>
                                <button class="btn btn-sm btn-primary" onclick="abrirModal('modalFAQ')" id="btnEditarFAQ" style="display: none;">
                                    <i class="fas fa-edit"></i> Editar FAQ
                                </button>
                            </div>
                            <div class="accordion" id="faqAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                            <span id="faq-pregunta-1">¬øC√≥mo agrego productos?</span>
                                        </button>
                                    </h2>
                                    <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <span id="faq-respuesta-1">Ve a la secci√≥n "Productos" y haz clic en "Agregar Producto". Completa el formulario y guarda.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                            <span id="faq-pregunta-2">¬øC√≥mo configuro pagos?</span>
                                        </button>
                                    </h2>
                                    <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <span id="faq-respuesta-2">Ve a "Configuraci√≥n" y selecciona los m√©todos de pago que quieres aceptar.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                            <span id="faq-pregunta-3">¬øC√≥mo agrego servicios?</span>
                                        </button>
                                    </h2>
                                    <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <span id="faq-respuesta-3">Ve a la secci√≥n "Servicios" y haz clic en "Agregar Servicio". Completa el formulario y guarda.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                            <span id="faq-pregunta-4">¬øC√≥mo registro una venta?</span>
                                        </button>
                                    </h2>
                                    <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <span id="faq-respuesta-4">Ve a la secci√≥n "Ventas" y haz clic en "Nueva Venta". Completa los datos del cliente y producto.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                            <span id="faq-pregunta-5">¬øC√≥mo contacto soporte?</span>
                                        </button>
                                    </h2>
                                    <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                        <div class="accordion-body">
                                            <span id="faq-respuesta-5">Puedes contactarnos por email, WhatsApp o tel√©fono. Los datos est√°n en la secci√≥n "Soporte".</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Restricci√≥n de Plan para FAQ -->
                            <div id="restriccionFAQ" class="alert alert-info mt-3">
                                <i class="fas fa-info-circle"></i> <strong>Plan Gratuito:</strong> 5 preguntas b√°sicas incluidas<br>
                                <i class="fas fa-crown"></i> <strong>Planes Pagos:</strong> FAQ completamente personalizable
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dise√±o de P√°gina Section -->
            <div id="diseno" class="content-section hidden">
                <h3>üé® Dise√±o de tu P√°gina Web</h3>
                <div class="alert alert-success">
                    <i class="fas fa-gift"></i> <strong>¬°GRATIS para todos los usuarios!</strong><br>
                    Personaliza el dise√±o de tu p√°gina web sin costo adicional.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h4>Configuraci√≥n B√°sica</h4>
                            <div class="form-group">
                                <label class="form-label">Nombre de tu Tienda</label>
                                <input type="text" class="form-control" id="nombreTiendaDiseno" placeholder="Mi Tienda">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Descripci√≥n de tu Tienda</label>
                                <textarea class="form-control" id="descripcionTiendaDiseno" rows="3" placeholder="Cu√©ntanos sobre tu negocio..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Color Principal</label>
                                <input type="color" class="form-control" id="colorPrincipalDiseno" value="#7C3AED">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h4>Elementos Visuales</h4>
                            <div class="form-group">
                                <label class="form-label">Logo de tu Tienda</label>
                                <input type="file" class="form-control" id="logoDiseno" accept="image/*" onchange="previewLogoDiseno(this)">
                                <div id="logoDisenoPreview" class="mt-2"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Imagen de Portada</label>
                                <input type="file" class="form-control" id="portadaDiseno" accept="image/*" onchange="previewPortadaDiseno(this)">
                                <div id="portadaDisenoPreview" class="mt-2"></div>
                            </div>
                            <button class="btn btn-primary" onclick="guardarDiseno()">Guardar Dise√±o</button>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="content-section">
                            <h4>Vista Previa de tu P√°gina</h4>
                            <div id="vistaPreviaDiseno" class="border p-3" style="min-height: 400px; background: #f8f9fa;">
                                <div class="text-center text-muted">
                                    <i class="fas fa-eye fa-3x mb-3"></i>
                                    <p>Vista previa de tu p√°gina web aparecer√° aqu√≠</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- M√©tricas y Anal√≠ticas Section -->
            <div id="metricas" class="content-section hidden">
                <h3>üìä M√©tricas y Anal√≠ticas</h3>
                <div class="alert alert-success">
                    <i class="fas fa-chart-line"></i> <strong>¬°Tu negocio est√° creciendo!</strong><br>
                    Aqu√≠ tienes todas las m√©tricas para optimizar tu emprendimiento.
                </div>
                
                <!-- Mensaje Motivacional -->
                <div id="mensajeMotivacional" class="content-section mb-4" style="background: linear-gradient(135deg, #F0F9FF, #E0F2FE); border-left: 4px solid #0EA5E9;">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <i class="fas fa-heart text-primary fa-2x"></i>
                        </div>
                        <div>
                            <h5 class="mb-1" id="tituloMotivacional">¬°Excelente trabajo!</h5>
                            <p class="mb-0" id="mensajeMotivacionalTexto">Cada d√≠a es una nueva oportunidad para crecer. ¬°Sigue as√≠!</p>
                        </div>
                    </div>
                </div>
                
                <!-- M√©tricas Principales -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <div class="h2 text-primary" id="totalVentasMetricas">$0</div>
                            <h6>Ventas Totales</h6>
                            <small class="text-muted" id="tendenciaVentas">+0% vs mes anterior</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <div class="h2 text-success" id="productosVendidos">0</div>
                            <h6>Productos Vendidos</h6>
                            <small class="text-muted" id="tendenciaProductos">+0% vs mes anterior</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <div class="h2 text-info" id="clientesNuevos">0</div>
                            <h6>Clientes Nuevos</h6>
                            <small class="text-muted" id="tendenciaClientes">+0% vs mes anterior</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="content-section text-center">
                            <div class="h2 text-warning" id="satisfaccionPromedio">0.0</div>
                            <h6>Satisfacci√≥n</h6>
                            <small class="text-muted" id="tendenciaSatisfaccion">‚≠ê Promedio</small>
                        </div>
                    </div>
                </div>
                
                <!-- Gr√°ficos -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>üìà Ventas por Mes</h5>
                            <div id="graficoVentas" style="height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <div class="text-center text-muted">
                                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                                    <p>Gr√°fico de ventas aparecer√° aqu√≠</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>ü•á Productos M√°s Vendidos</h5>
                            <div id="graficoProductos" style="height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <div class="text-center text-muted">
                                    <i class="fas fa-chart-pie fa-3x mb-3"></i>
                                    <p>Gr√°fico de productos aparecer√° aqu√≠</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- An√°lisis Avanzado (Solo Planes Pagos) -->
                <div id="analisisAvanzado" class="row mb-4" style="display: none;">
                    <div class="col-12">
                        <div class="content-section">
                            <h5>üîç An√°lisis Avanzado</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="content-section">
                                        <h6>üìä Conversi√≥n</h6>
                                        <div class="h4 text-primary" id="tasaConversion">0%</div>
                                        <small class="text-muted">Visitantes que compran</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="content-section">
                                        <h6>üí∞ Valor Promedio</h6>
                                        <div class="h4 text-success" id="valorPromedioTicket">$0</div>
                                        <small class="text-muted">Por compra</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="content-section">
                                        <h6>üîÑ Retenci√≥n</h6>
                                        <div class="h4 text-info" id="tasaRetencion">0%</div>
                                        <small class="text-muted">Clientes que regresan</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recursos y Ayuda -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="content-section">
                            <h5>üí° Recursos para Mejorar</h5>
                            <div id="recursosAyuda">
                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb"></i> <strong>Consejo del d√≠a:</strong> 
                                    <span id="consejoDelDia">Mant√©n siempre un inventario actualizado para no perder ventas.</span>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="border p-3 rounded mb-3">
                                            <h6>üìö Art√≠culos Recomendados</h6>
                                            <ul class="list-unstyled">
                                                <li><a href="#" class="text-decoration-none">C√≥mo aumentar las ventas</a></li>
                                                <li><a href="#" class="text-decoration-none">Marketing digital b√°sico</a></li>
                                                <li><a href="#" class="text-decoration-none">Atenci√≥n al cliente</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="border p-3 rounded mb-3">
                                            <h6>üéØ Acciones Sugeridas</h6>
                                            <ul class="list-unstyled">
                                                <li><a href="#" class="text-decoration-none">Optimizar descripciones</a></li>
                                                <li><a href="#" class="text-decoration-none">Mejorar fotos</a></li>
                                                <li><a href="#" class="text-decoration-none">Promocionar productos</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section">
                            <h5>üéØ Objetivos</h5>
                            <div id="objetivos">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Ventas del mes</span>
                                        <span id="progresoVentas">0/1000</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 0%" id="barraProgresoVentas"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Clientes nuevos</span>
                                        <span id="progresoClientes">0/50</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="barraProgresoClientes"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Satisfacci√≥n</span>
                                        <span id="progresoSatisfaccion">0/5</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" id="barraProgresoSatisfaccion"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Restricci√≥n de Plan -->
                <div id="restriccionMetricas" class="alert alert-warning">
                    <i class="fas fa-crown"></i> <strong>An√°lisis Avanzado disponible con Plan B√°sico o Premium</strong><br>
                    <i class="fas fa-gift"></i> <strong>Plan Gratuito:</strong> M√©tricas b√°sicas incluidas
                </div>
            </div>

            <!-- Feedbacks Section -->
            <div id="feedbacks" class="content-section hidden">
                <h3>üí¨ Feedbacks y Reportes</h3>
                <div class="alert alert-info">
                    <i class="fas fa-comments"></i> <strong>Tu opini√≥n es importante</strong><br>
                    Ay√∫danos a mejorar Cresalia reportando errores, sugiriendo mejoras y compartiendo tu experiencia.
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="content-section">
                            <h4>Enviar Feedback</h4>
                            <form id="formFeedback">
                                <div class="form-group">
                                    <label class="form-label">Tipo de Feedback</label>
                                    <select class="form-select" id="tipoFeedback" required>
                                        <option value="">Selecciona un tipo</option>
                                        <option value="error">üêõ Reportar Error</option>
                                        <option value="mejora">üí° Sugerir Mejora</option>
                                        <option value="funcion">‚ú® Nueva Funci√≥n</option>
                                        <option value="experiencia">üòä Experiencia de Usuario</option>
                                        <option value="otro">üìù Otro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√≠tulo</label>
                                    <input type="text" class="form-control" id="tituloFeedback" placeholder="Resumen breve del feedback" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Descripci√≥n Detallada</label>
                                    <textarea class="form-control" id="descripcionFeedback" rows="4" placeholder="Describe tu feedback en detalle..." required></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Prioridad</label>
                                    <select class="form-select" id="prioridadFeedback">
                                        <option value="baja">üü¢ Baja</option>
                                        <option value="media">üü° Media</option>
                                        <option value="alta">üî¥ Alta</option>
                                        <option value="critica">üö® Cr√≠tica</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Enviar Feedback</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section">
                            <h4>Mis Feedbacks Enviados</h4>
                            <div id="listaFeedbacks">
                                <p class="text-muted">No hay feedbacks enviados</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Suscripciones Section -->
            <div id="suscripciones" class="content-section hidden">
                <h3>Suscripciones y Planes</h3>
                <div class="row">
                    <div class="col-md-4">
                        <div class="content-section text-center">
                            <h4>Plan Gratuito</h4>
                            <div class="h2 text-primary">$0/mes</div>
                            <ul class="list-unstyled">
                                <li>‚úì Hasta 10 productos</li>
                                <li>‚úì Hasta 5 servicios</li>
                                <li>‚úì Soporte b√°sico</li>
                                <li>‚úì <strong>Dise√±o de p√°gina GRATIS</strong></li>
                                <li>‚úó Sin chatbot IA</li>
                                <li>‚úó Sin bienestar emocional</li>
                            </ul>
                            <button class="btn btn-outline-primary" disabled>Plan Actual</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section text-center">
                            <h4>Plan B√°sico</h4>
                            <div class="h2 text-success">$29/mes</div>
                            <ul class="list-unstyled">
                                <li>‚úì Productos ilimitados</li>
                                <li>‚úì Servicios ilimitados</li>
                                <li>‚úì Soporte prioritario</li>
                                <li>‚úì <strong>Dise√±o de p√°gina GRATIS</strong></li>
                                <li>‚úì Chatbot IA b√°sico</li>
                                <li>‚úì Bienestar emocional</li>
                            </ul>
                            <button class="btn btn-success" onclick="cambiarPlan('basico')">Actualizar</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section text-center">
                            <h4>Plan Premium</h4>
                            <div class="h2 text-warning">$99/mes</div>
                            <ul class="list-unstyled">
                                <li>‚úì Todo del Plan B√°sico</li>
                                <li>‚úì <strong>Dise√±o de p√°gina GRATIS</strong></li>
                                <li>‚úì Chatbot IA avanzado</li>
                                <li>‚úì Analytics avanzados</li>
                                <li>‚úì Soporte 24/7</li>
                                <li>‚úì Personalizaci√≥n completa</li>
                            </ul>
                            <button class="btn btn-warning" onclick="cambiarPlan('premium')">Actualizar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historial Section -->
            <div id="historial" class="content-section hidden">
                <h3>Historial y Actividad</h3>
                
                <!-- Pesta√±as del Historial -->
                <ul class="nav nav-tabs mb-4" id="historialTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="sesiones-tab" data-bs-toggle="tab" data-bs-target="#sesiones" type="button" role="tab">
                            <i class="fas fa-sign-in-alt"></i> Inicios de Sesi√≥n
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="ventas-historial-tab" data-bs-toggle="tab" data-bs-target="#ventas-historial" type="button" role="tab">
                            <i class="fas fa-chart-line"></i> Historial de Ventas
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="turnos-historial-tab" data-bs-toggle="tab" data-bs-target="#turnos-historial" type="button" role="tab">
                            <i class="fas fa-calendar-alt"></i> Historial de Turnos
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="feedbacks-recibidos-tab" data-bs-toggle="tab" data-bs-target="#feedbacks-recibidos" type="button" role="tab">
                            <i class="fas fa-comments"></i> Feedbacks de Compradores
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="historialTabContent">
                    <!-- Inicios de Sesi√≥n -->
                    <div class="tab-pane fade show active" id="sesiones" role="tabpanel">
                        <h4>Historial de Inicios de Sesi√≥n</h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Fecha y Hora</th>
                                        <th>IP</th>
                                        <th>Dispositivo</th>
                                        <th>Ubicaci√≥n</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaSesiones">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Cargando historial...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Historial de Ventas -->
                    <div class="tab-pane fade" id="ventas-historial" role="tabpanel">
                        <h4>Historial Completo de Ventas</h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Producto/Servicio</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaVentasHistorial">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">Cargando historial...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Historial de Turnos -->
                    <div class="tab-pane fade" id="turnos-historial" role="tabpanel">
                        <h4>Historial de Turnos</h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Cliente</th>
                                        <th>Servicio</th>
                                        <th>Estado</th>
                                        <th>Notas</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaTurnosHistorial">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">Cargando historial...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Feedbacks de Compradores -->
                    <div class="tab-pane fade" id="feedbacks-recibidos" role="tabpanel">
                        <h4>Feedbacks de Compradores</h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div id="listaFeedbacksCompradores">
                                    <p class="text-muted">No hay feedbacks de compradores</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="content-section">
                                    <h5>Estad√≠sticas de Feedbacks</h5>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>‚≠ê Promedio:</span>
                                            <span id="promedioEstrellas">0.0</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>üìù Total Feedbacks:</span>
                                            <span id="totalFeedbacks">0</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>üòä Positivos:</span>
                                            <span id="feedbacksPositivos">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n Section -->
            <div id="configuracion" class="content-section hidden">
                <h3>Configuraci√≥n</h3>
                
                <!-- Configuraci√≥n B√°sica -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Nombre de la Tienda</label>
                            <input type="text" class="form-control" id="nombreTienda" value="Mi Tienda">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Email de Contacto</label>
                            <input type="email" class="form-control" id="emailTienda" value="contacto@mitienda.com">
                        </div>
                    </div>
                </div>
                
                <!-- Personalizaci√≥n Visual -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4>üé® Personalizaci√≥n Visual</h4>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Color Principal</label>
                            <input type="color" class="form-control" id="colorPrincipal" value="#7C3AED" onchange="aplicarColorPersonalizado()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Color Secundario</label>
                            <input type="color" class="form-control" id="colorSecundario" value="#EC4899" onchange="aplicarColorPersonalizado()">
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Logo de la Tienda</label>
                            <input type="file" class="form-control" id="logoTienda" accept="image/*" onchange="previewLogo(this)">
                            <div id="logoPreview" class="mt-2"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Video de Presentaci√≥n</label>
                            <input type="file" class="form-control" id="videoPresentacion" accept="video/*" onchange="previewVideo(this)">
                            <div id="videoPreview" class="mt-2"></div>
                            <small class="text-muted">M√°ximo 50MB. Formatos: MP4, AVI, MOV</small>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Imagen de Portada</label>
                            <input type="file" class="form-control" id="imagenPortada" accept="image/*" onchange="previewImagenPortada(this)">
                            <div id="portadaPreview" class="mt-2"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Tema Predefinido</label>
                            <select class="form-select" id="temaSeleccionado" onchange="sistemaTemas.cambiarTema(this.value)">
                                <option value="default">Default</option>
                                <option value="dark">Dark</option>
                                <option value="ocean">Ocean</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Restricci√≥n de Plan para Personalizaci√≥n -->
                <div id="restriccionPersonalizacion" class="alert alert-warning">
                    <i class="fas fa-crown"></i> <strong>Funci√≥n Premium</strong><br>
                    Personalizaci√≥n visual disponible con Plan B√°sico o Premium
                </div>
                
                <!-- Configuraci√≥n de Temas -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Idioma</label>
                            <select class="form-select" id="idiomaSeleccionado">
                                <option value="es">Espa√±ol</option>
                                <option value="en">English</option>
                                <option value="pt">Portugu√™s</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Zona Horaria</label>
                            <select class="form-select" id="zonaHoraria">
                                <option value="America/Argentina/Buenos_Aires">Argentina üá¶üá∑ (GMT-3)</option>
                                <option value="America/La_Paz">Bolivia üáßüá¥ (GMT-4)</option>
                                <option value="America/Santiago">Chile üá®üá± (GMT-3)</option>
                                <option value="America/Bogota">Colombia üá®üá¥ (GMT-5)</option>
                                <option value="America/Costa_Rica">Costa Rica üá®üá∑ (GMT-6)</option>
                                <option value="America/Havana">Cuba üá®üá∫ (GMT-5)</option>
                                <option value="America/Santo_Domingo">Rep√∫blica Dominicana üá©üá¥ (GMT-4)</option>
                                <option value="America/Guayaquil">Ecuador üá™üá® (GMT-5)</option>
                                <option value="America/El_Salvador">El Salvador üá∏üáª (GMT-6)</option>
                                <option value="Europe/Madrid">Espa√±a üá™üá∏ (GMT+1)</option>
                                <option value="Africa/Malabo">Guinea Ecuatorial üá¨üá∂ (GMT+1)</option>
                                <option value="America/Guatemala">Guatemala üá¨üáπ (GMT-6)</option>
                                <option value="America/Tegucigalpa">Honduras üá≠üá≥ (GMT-6)</option>
                                <option value="America/Mexico_City">M√©xico üá≤üáΩ (GMT-6)</option>
                                <option value="America/Managua">Nicaragua üá≥üáÆ (GMT-6)</option>
                                <option value="America/Panama">Panam√° üáµüá¶ (GMT-5)</option>
                                <option value="America/Asuncion">Paraguay üáµüáæ (GMT-4)</option>
                                <option value="America/Lima">Per√∫ üáµüá™ (GMT-5)</option>
                                <option value="America/Puerto_Rico">Puerto Rico üáµüá∑ (GMT-4)</option>
                                <option value="America/Montevideo">Uruguay üá∫üáæ (GMT-3)</option>
                                <option value="America/Caracas">Venezuela üáªüá™ (GMT-4)</option>
                                <option value="UTC">UTC (GMT+0)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Configuraci√≥n de Env√≠os y Entrega -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4>üöö Configuraci√≥n de Env√≠os y Entrega</h4>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Env√≠os a Domicilio</h5>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="enviosDomicilio" checked>
                                <label class="form-check-label" for="enviosDomicilio">
                                    Habilitar env√≠os a domicilio
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Costo de env√≠o</label>
                                <input type="number" class="form-control" id="costoEnvio" placeholder="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Env√≠o gratis desde</label>
                                <input type="number" class="form-control" id="envioGratisDesde" placeholder="0.00" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Puntos de Encuentro</h5>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="puntosEncuentro" checked>
                                <label class="form-check-label" for="puntosEncuentro">
                                    Habilitar puntos de encuentro
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Radio de cobertura (km)</label>
                                <input type="number" class="form-control" id="radioCobertura" placeholder="10" min="1" max="50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Direcci√≥n base</label>
                                <input type="text" class="form-control" id="direccionBase" placeholder="Tu direcci√≥n">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Moto Mandado</h5>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="motoMandado" checked>
                                <label class="form-check-label" for="motoMandado">
                                    Ofrecer servicio de moto mandado
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Precio por km</label>
                                <input type="number" class="form-control" id="precioPorKm" placeholder="0.50" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Precio m√≠nimo</label>
                                <input type="number" class="form-control" id="precioMinimoMoto" placeholder="5.00" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Configuraci√≥n de Entrega</h5>
                            <div class="form-group">
                                <label class="form-label">Tiempo de preparaci√≥n (minutos)</label>
                                <input type="number" class="form-control" id="tiempoPreparacion" placeholder="30" min="5" max="120">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Horarios de entrega</label>
                                <div class="row">
                                    <div class="col-6">
                                        <input type="time" class="form-control" id="horaInicioEntrega" value="09:00">
                                    </div>
                                    <div class="col-6">
                                        <input type="time" class="form-control" id="horaFinEntrega" value="18:00">
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="guardarConfiguracionEnvios()">
                                <i class="fas fa-save"></i> Guardar Configuraci√≥n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cambio de Contrase√±a -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Cambiar Contrase√±a</h5>
                            <form id="formCambiarPassword">
                                <div class="form-group">
                                    <label class="form-label">Contrase√±a actual</label>
                                    <input type="password" class="form-control" id="passwordActual" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nueva contrase√±a</label>
                                    <input type="password" class="form-control" id="passwordNueva" required minlength="6">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirmar nueva contrase√±a</label>
                                    <input type="password" class="form-control" id="passwordConfirmar" required minlength="6">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-key"></i> Cambiar Contrase√±a
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="content-section">
                            <h5>Informaci√≥n de Seguridad</h5>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> <strong>√öltimo cambio de contrase√±a:</strong><br>
                                <span id="ultimoCambioPassword">Nunca</span>
                            </div>
                            <div class="alert alert-warning">
                                <i class="fas fa-shield-alt"></i> <strong>Recomendaciones de seguridad:</strong><br>
                                ‚Ä¢ Usa una contrase√±a segura con al menos 8 caracteres<br>
                                ‚Ä¢ Incluye n√∫meros y s√≠mbolos<br>
                                ‚Ä¢ No compartas tu contrase√±a con nadie
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de Seguridad -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4>Seguridad</h4>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="prevenirClicDerecho" checked>
                            <label class="form-check-label" for="prevenirClicDerecho">
                                Prevenir clic derecho
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="prevenirF12" checked>
                            <label class="form-check-label" for="prevenirF12">
                                Prevenir F12
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="detectarInspeccion" checked>
                            <label class="form-check-label" for="detectarInspeccion">
                                Detectar inspecci√≥n
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Configuraci√≥n de Backup -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4>Backup y Restauraci√≥n</h4>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="sistemaBackup.crearBackup()">
                                <i class="fas fa-save"></i> Crear Backup
                            </button>
                            <button class="btn btn-secondary" onclick="sistemaReportes.exportarDatos()">
                                <i class="fas fa-download"></i> Exportar Datos
                            </button>
                            <button class="btn btn-warning" onclick="mostrarBackups()">
                                <i class="fas fa-history"></i> Ver Backups
                            </button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="guardarConfiguracion()">
                    <i class="fas fa-save"></i> Guardar Configuraci√≥n
                </button>
            </div>
        </main>
    </div>

    <!-- Modal Producto -->
    <div id="modalProducto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agregar Producto</h3>
                <button class="modal-close" onclick="cerrarModal('modalProducto')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProducto">
                    <div class="form-group">
                        <label class="form-label">Nombre del Producto</label>
                        <input type="text" class="form-control" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea class="form-control" name="descripcion" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Precio</label>
                                <input type="number" class="form-control" name="precio" step="0.01" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Stock</label>
                                <input type="number" class="form-control" name="stock" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categor√≠a</label>
                        <select class="form-select" name="categoria" required>
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="electronica">Electr√≥nica</option>
                            <option value="ropa">Ropa</option>
                            <option value="hogar">Hogar</option>
                            <option value="belleza">Belleza</option>
                            <option value="deportes">Deportes</option>
                            <option value="libros">Libros</option>
                            <option value="juguetes">Juguetes</option>
                            <option value="alimentacion">Alimentaci√≥n</option>
                            <option value="salud">Salud</option>
                            <option value="automotriz">Automotriz</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Im√°genes del Producto</label>
                        <input type="file" class="form-control" name="imagenes" accept="image/*" multiple onchange="previewImages(this)">
                        <div id="productoImagePreview" class="mt-2"></div>
                        <small class="text-muted">Puedes seleccionar m√∫ltiples im√°genes</small>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalProducto')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Producto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Servicio -->
    <div id="modalServicio" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Agregar Servicio</h3>
                <button class="modal-close" onclick="cerrarModal('modalServicio')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formServicio">
                    <div class="form-group">
                        <label class="form-label">Nombre del Servicio</label>
                        <input type="text" class="form-control" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea class="form-control" name="descripcion" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Precio</label>
                                <input type="number" class="form-control" name="precio" step="0.01" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Duraci√≥n (minutos)</label>
                                <input type="number" class="form-control" name="duracion" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categor√≠a</label>
                        <select class="form-select" name="categoria" required>
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="consultoria">Consultor√≠a</option>
                            <option value="diseno">Dise√±o</option>
                            <option value="programacion">Programaci√≥n</option>
                            <option value="marketing">Marketing</option>
                            <option value="contabilidad">Contabilidad</option>
                            <option value="legal">Legal</option>
                            <option value="salud">Salud</option>
                            <option value="educacion">Educaci√≥n</option>
                            <option value="coaching">Coaching</option>
                            <option value="fotografia">Fotograf√≠a</option>
                            <option value="eventos">Eventos</option>
                            <option value="limpieza">Limpieza</option>
                            <option value="reparaciones">Reparaciones</option>
                            <option value="transporte">Transporte</option>
                            <option value="belleza">Belleza</option>
                            <option value="fitness">Fitness</option>
                            <option value="gastronomia">Gastronom√≠a</option>
                            <option value="turismo">Turismo</option>
                            <option value="inmobiliaria">Inmobiliaria</option>
                            <option value="seguros">Seguros</option>
                        </select>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalServicio')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Servicio</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Turno -->
    <div id="modalTurno" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configurar Turnos</h3>
                <button class="modal-close" onclick="cerrarModal('modalTurno')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formTurno">
                    <div class="form-group">
                        <label class="form-label">D√≠a de la Semana</label>
                        <select class="form-select" name="dia" required>
                            <option value="">Seleccionar d√≠a</option>
                            <option value="lunes">Lunes</option>
                            <option value="martes">Martes</option>
                            <option value="miercoles">Mi√©rcoles</option>
                            <option value="jueves">Jueves</option>
                            <option value="viernes">Viernes</option>
                            <option value="sabado">S√°bado</option>
                            <option value="domingo">Domingo</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Hora de Inicio</label>
                                <input type="time" class="form-control" name="horaInicio" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Hora de Fin</label>
                                <input type="time" class="form-control" name="horaFin" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duraci√≥n por Turno (minutos)</label>
                        <select class="form-select" name="duracion" required>
                            <option value="15">15 minutos</option>
                            <option value="30">30 minutos</option>
                            <option value="45">45 minutos</option>
                            <option value="60">1 hora</option>
                            <option value="90">1.5 horas</option>
                            <option value="120">2 horas</option>
                        </select>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalTurno')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Configuraci√≥n</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Venta -->
    <div id="modalVenta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Nueva Venta</h3>
                <button class="modal-close" onclick="cerrarModal('modalVenta')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formVenta">
                    <div class="form-group">
                        <label class="form-label">Cliente</label>
                        <input type="text" class="form-control" name="cliente" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Producto/Servicio</label>
                        <select class="form-select" name="item" required>
                            <option value="">Seleccionar item</option>
                            <optgroup label="Productos">
                                <option value="producto-1">Producto 1 - $100</option>
                                <option value="producto-2">Producto 2 - $200</option>
                            </optgroup>
                            <optgroup label="Servicios">
                                <option value="servicio-1">Servicio 1 - $150</option>
                                <option value="servicio-2">Servicio 2 - $300</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Cantidad</label>
                                <input type="number" class="form-control" name="cantidad" value="1" min="1" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">M√©todo de Pago</label>
                                <select class="form-select" name="metodoPago" required>
                                    <option value="efectivo">Efectivo</option>
                                    <option value="transferencia">Transferencia</option>
                                    <option value="mercadopago">MercadoPago</option>
                                    <option value="paypal">PayPal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total</label>
                        <input type="number" class="form-control" name="total" step="0.01" required>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalVenta')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Registrar Venta</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Oferta -->
    <div id="modalOferta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Crear Oferta</h3>
                <button class="modal-close" onclick="cerrarModal('modalOferta')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formOferta">
                    <div class="form-group">
                        <label class="form-label">T√≠tulo de la Oferta</label>
                        <input type="text" class="form-control" name="titulo" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea class="form-control" name="descripcion" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Descuento (%)</label>
                                <input type="number" class="form-control" name="descuento" min="1" max="100" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Fecha de Vencimiento</label>
                                <input type="date" class="form-control" name="vencimiento" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Imagen de la Oferta</label>
                        <input type="file" class="form-control" name="imagen" accept="image/*" onchange="previewImage(this)">
                        <div id="imagePreview" class="mt-2"></div>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalOferta')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Oferta</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal FAQ -->
    <div id="modalFAQ" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Preguntas Frecuentes</h3>
                <button class="modal-close" onclick="cerrarModal('modalFAQ')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formFAQ">
                    <div class="form-group">
                        <label class="form-label">Pregunta 1</label>
                        <input type="text" class="form-control" id="faq-pregunta-1-edit" value="¬øC√≥mo agrego productos?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta 1</label>
                        <textarea class="form-control" id="faq-respuesta-1-edit" rows="2">Ve a la secci√≥n "Productos" y haz clic en "Agregar Producto". Completa el formulario y guarda.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pregunta 2</label>
                        <input type="text" class="form-control" id="faq-pregunta-2-edit" value="¬øC√≥mo configuro pagos?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta 2</label>
                        <textarea class="form-control" id="faq-respuesta-2-edit" rows="2">Ve a "Configuraci√≥n" y selecciona los m√©todos de pago que quieres aceptar.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pregunta 3</label>
                        <input type="text" class="form-control" id="faq-pregunta-3-edit" value="¬øC√≥mo agrego servicios?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta 3</label>
                        <textarea class="form-control" id="faq-respuesta-3-edit" rows="2">Ve a la secci√≥n "Servicios" y haz clic en "Agregar Servicio". Completa el formulario y guarda.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pregunta 4</label>
                        <input type="text" class="form-control" id="faq-pregunta-4-edit" value="¬øC√≥mo registro una venta?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta 4</label>
                        <textarea class="form-control" id="faq-respuesta-4-edit" rows="2">Ve a la secci√≥n "Ventas" y haz clic en "Nueva Venta". Completa los datos del cliente y producto.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pregunta 5</label>
                        <input type="text" class="form-control" id="faq-pregunta-5-edit" value="¬øC√≥mo contacto soporte?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta 5</label>
                        <textarea class="form-control" id="faq-respuesta-5-edit" rows="2">Puedes contactarnos por email, WhatsApp o tel√©fono. Los datos est√°n en la secci√≥n "Soporte".</textarea>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalFAQ')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar FAQ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal CRISLA -->
    <div id="modalCrisla" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üíú Configurar CRISLA</h3>
                <button class="modal-close" onclick="cerrarModal('modalCrisla')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCrisla">
                    <div class="form-group">
                        <label class="form-label">Mensaje de Bienvenida</label>
                        <textarea class="form-control" id="crisla-bienvenida" rows="3">¬°Hola! Soy CRISLA, tu soporte emocional. ¬øC√≥mo te sientes hoy? Estoy aqu√≠ para escucharte y apoyarte.</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta para Estado Feliz</label>
                        <textarea class="form-control" id="crisla-feliz" rows="2">¬°Qu√© alegr√≠a verte tan feliz! Mant√©n esa energ√≠a positiva. ¬øHay algo espec√≠fico en lo que pueda ayudarte hoy?</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta para Estado Neutral</label>
                        <textarea class="form-control" id="crisla-neutral" rows="2">Entiendo que te sientes neutral. Es normal tener d√≠as as√≠. ¬øHay algo que te preocupe o en lo que pueda ayudarte?</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Respuesta para Estado Triste</label>
                        <textarea class="form-control" id="crisla-triste" rows="2">Lamento que te sientas triste. Recuerda que no est√°s solo. Estoy aqu√≠ para escucharte. ¬øQuieres contarme qu√© te pasa?</textarea>
                    </div>
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalCrisla')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar CRISLA</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Bienestar Emocional -->
    <div id="modalBienestar" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üíú Bienestar Emocional</h3>
                <button class="modal-close" onclick="cerrarModal('modalBienestar')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-heart"></i> <strong>CRISLA est√° aqu√≠ para ti</strong><br>
                    Tu bienestar emocional es importante para el √©xito de tu negocio.
                </div>
                
                <div class="form-group">
                    <label class="form-label">¬øC√≥mo te sientes hoy?</label>
                    <div class="row">
                        <div class="col-3">
                            <button class="btn btn-outline-danger w-100" onclick="actualizarEstadoAnimo('triste')">
                                <i class="fas fa-frown"></i><br>Triste
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="btn btn-outline-warning w-100" onclick="actualizarEstadoAnimo('neutral')">
                                <i class="fas fa-meh"></i><br>Neutral
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="btn btn-outline-success w-100" onclick="actualizarEstadoAnimo('feliz')">
                                <i class="fas fa-smile"></i><br>Feliz
                            </button>
                        </div>
                        <div class="col-3">
                            <button class="btn btn-outline-primary w-100" onclick="actualizarEstadoAnimo('emocionado')">
                                <i class="fas fa-star"></i><br>Emocionado
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Consejo del d√≠a</label>
                    <div class="alert alert-light" id="consejoBienestar">
                        <i class="fas fa-lightbulb"></i> <span id="textoConsejo">Cada d√≠a es una nueva oportunidad para crecer. ¬°Sigue as√≠!</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Chat con CRISLA</label>
                    <div class="border rounded p-3" style="height: 200px; overflow-y: auto;" id="chatCrisla">
                        <div class="text-center text-muted">
                            <i class="fas fa-heart text-primary"></i><br>
                            <small>CRISLA est√° aqu√≠ para escucharte</small>
                        </div>
                    </div>
                    <div class="input-group mt-2">
                        <input type="text" class="form-control" id="mensajeCrisla" placeholder="Escribe tu mensaje...">
                        <button class="btn btn-primary" onclick="enviarMensajeCrisla()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Chatbot IA -->
    <div id="modalChatbot" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ü§ñ Configurar Chatbot IA</h3>
                <button class="modal-close" onclick="cerrarModal('modalChatbot')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formChatbot">
                    <div class="form-group">
                        <label class="form-label" for="nombreBot">Nombre del Bot</label>
                        <input type="text" class="form-control" id="nombreBot" value="Asistente Virtual" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="mensajeBienvenidaBot">Mensaje de Bienvenida</label>
                        <textarea class="form-control" id="mensajeBienvenidaBot" rows="3">¬°Hola! Soy tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Respuestas Personalizadas</label>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label" for="palabraClave">Palabra Clave</label>
                                <input type="text" class="form-control" id="palabraClave" placeholder="ej: precio">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="respuestaPersonalizada">Respuesta</label>
                                <input type="text" class="form-control" id="respuestaPersonalizada" placeholder="ej: Los precios var√≠an seg√∫n el producto">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Horario de Atenci√≥n</label>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label" for="horarioDesde">Desde</label>
                                <input type="time" class="form-control" id="horarioDesde" value="09:00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="horarioHasta">Hasta</label>
                                <input type="time" class="form-control" id="horarioHasta" value="18:00">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="mensajeFueraHorario">Mensaje Fuera de Horario</label>
                        <textarea class="form-control" id="mensajeFueraHorario" rows="2">Estamos fuera de horario. Te responderemos pronto.</textarea>
                    </div>
                    
                    <div class="text-center">
                        <button type="button" class="btn btn-primary" onclick="guardarConfiguracionBot()">
                            <i class="fas fa-save"></i> Guardar Configuraci√≥n
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Soporte -->
    <div id="modalSoporte" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üÜò Configurar Soporte</h3>
                <button class="modal-close" onclick="cerrarModal('modalSoporte')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formSoporte">
                    <div class="form-group">
                        <label class="form-label" for="emailSoporte">Email de Contacto</label>
                        <input type="email" class="form-control" id="emailSoporte" placeholder="tu@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="whatsappSoporte">WhatsApp</label>
                        <input type="tel" class="form-control" id="whatsappSoporte" placeholder="+54 9 11 1234-5678">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="telefonoSoporte">Tel√©fono</label>
                        <input type="tel" class="form-control" id="telefonoSoporte" placeholder="+54 11 1234-5678">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="direccionSoporte">Direcci√≥n</label>
                        <textarea class="form-control" id="direccionSoporte" rows="2" placeholder="Tu direcci√≥n f√≠sica"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Horario de Atenci√≥n</label>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label" for="soporteDesde">Desde</label>
                                <input type="time" class="form-control" id="soporteDesde" value="09:00">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="soporteHasta">Hasta</label>
                                <input type="time" class="form-control" id="soporteHasta" value="18:00">
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="button" class="btn btn-primary" onclick="guardarConfiguracionSoporte()">
                            <i class="fas fa-save"></i> Guardar Configuraci√≥n
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Suscripciones -->
    <div id="modalSuscripciones" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üí≥ Suscripciones</h3>
                <button class="modal-close" onclick="cerrarModal('modalSuscripciones')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="content-section text-center">
                            <h5 class="text-primary">Plan Gratuito</h5>
                            <div class="h2 text-primary">$0</div>
                            <ul class="list-unstyled">
                                <li>‚úÖ 5 productos</li>
                                <li>‚úÖ 3 servicios</li>
                                <li>‚úÖ M√©tricas b√°sicas</li>
                                <li>‚úÖ Soporte por email</li>
                            </ul>
                            <button class="btn btn-outline-primary" onclick="cambiarPlan('gratuito')">
                                Plan Actual
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section text-center border-primary">
                            <h5 class="text-success">Plan B√°sico</h5>
                            <div class="h2 text-success">$29/mes</div>
                            <ul class="list-unstyled">
                                <li>‚úÖ 50 productos</li>
                                <li>‚úÖ 20 servicios</li>
                                <li>‚úÖ M√©tricas avanzadas</li>
                                <li>‚úÖ Soporte prioritario</li>
                                <li>‚úÖ Chatbot personalizable</li>
                            </ul>
                            <button class="btn btn-success" onclick="cambiarPlan('basico')">
                                Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-section text-center">
                            <h5 class="text-warning">Plan Premium</h5>
                            <div class="h2 text-warning">$59/mes</div>
                            <ul class="list-unstyled">
                                <li>‚úÖ Productos ilimitados</li>
                                <li>‚úÖ Servicios ilimitados</li>
                                <li>‚úÖ Analytics completos</li>
                                <li>‚úÖ Soporte 24/7</li>
                                <li>‚úÖ CRISLA personalizada</li>
                                <li>‚úÖ Dise√±o personalizado</li>
                            </ul>
                            <button class="btn btn-warning" onclick="cambiarPlan('premium')">
                                Actualizar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle"></i> <strong>Cancelaci√≥n:</strong> Puedes cancelar tu suscripci√≥n en cualquier momento desde esta secci√≥n.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Dise√±o de P√°gina -->
    <div id="modalDiseno" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üé® Dise√±o de P√°gina</h3>
                <button class="modal-close" onclick="cerrarModal('modalDiseno')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formDiseno">
                    <div class="form-group">
                        <label class="form-label" for="nombreTiendaDiseno">Nombre de la Tienda</label>
                        <input type="text" class="form-control" id="nombreTiendaDiseno" placeholder="Mi Tienda">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="descripcionTiendaDiseno">Descripci√≥n</label>
                        <textarea class="form-control" id="descripcionTiendaDiseno" rows="3" placeholder="Describe tu tienda..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="colorPrincipalDiseno">Color Principal</label>
                        <input type="color" class="form-control" id="colorPrincipalDiseno" value="#007bff">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="colorSecundarioDiseno">Color Secundario</label>
                        <input type="color" class="form-control" id="colorSecundarioDiseno" value="#6c757d">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="logoDiseno">Logo</label>
                        <input type="file" class="form-control" id="logoDiseno" accept="image/*" onchange="previewLogoDiseno(this)">
                        <div id="previewLogoDiseno" class="mt-2"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="portadaDiseno">Imagen de Portada</label>
                        <input type="file" class="form-control" id="portadaDiseno" accept="image/*" onchange="previewPortadaDiseno(this)">
                        <div id="previewPortadaDiseno" class="mt-2"></div>
                    </div>
                    
                    <div class="text-center">
                        <button type="button" class="btn btn-primary" onclick="guardarDiseno()">
                            <i class="fas fa-save"></i> Guardar Dise√±o
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // ============================================
        // SISTEMA DE INTERCONEXIONES
        // ============================================
        
        class SistemaInterconexiones {
            constructor() {
                this.conexiones = new Map();
                this.eventos = new Map();
                this.inicializar();
            }
            
            inicializar() {
                console.log('üîó Sistema de Interconexiones inicializado');
                this.configurarEventos();
                this.establecerConexiones();
            }
            
            configurarEventos() {
                // Eventos de productos
                this.eventos.set('producto_agregado', (data) => {
                    this.notificarInterconexion('producto_agregado', data);
                    this.actualizarAnalytics('productos', 'agregado');
                });
                
                // Eventos de servicios
                this.eventos.set('servicio_agregado', (data) => {
                    this.notificarInterconexion('servicio_agregado', data);
                    this.actualizarAnalytics('servicios', 'agregado');
                });
                
                // Eventos de ventas
                this.eventos.set('venta_realizada', (data) => {
                    this.notificarInterconexion('venta_realizada', data);
                    this.actualizarAnalytics('ventas', 'realizada');
                });
            }
            
            establecerConexiones() {
                // Conexi√≥n con analytics
                this.conexiones.set('analytics', {
                    activa: true,
                    ultimaActividad: new Date(),
                    datos: {}
                });
                
                // Conexi√≥n con notificaciones
                this.conexiones.set('notificaciones', {
                    activa: true,
                    ultimaActividad: new Date(),
                    datos: {}
                });
                
                // Conexi√≥n con pagos
                this.conexiones.set('pagos', {
                    activa: true,
                    ultimaActividad: new Date(),
                    datos: {}
                });
            }
            
            notificarInterconexion(tipo, datos) {
                console.log(`üîó Interconexi√≥n: ${tipo}`, datos);
                
                // Notificar a analytics
                if (this.conexiones.get('analytics').activa) {
                    this.actualizarAnalytics(tipo, datos);
                }
                
                // Notificar a notificaciones
                if (this.conexiones.get('notificaciones').activa) {
                    this.enviarNotificacion(tipo, datos);
                }
            }
            
            actualizarAnalytics(tipo, datos) {
                const analytics = JSON.parse(localStorage.getItem('analytics') || '{}');
                const fecha = new Date().toISOString().split('T')[0];
                
                if (!analytics[fecha]) {
                    analytics[fecha] = {
                        productos: 0,
                        servicios: 0,
                        ventas: 0,
                        ingresos: 0
                    };
                }
                
                if (tipo.includes('producto')) analytics[fecha].productos++;
                if (tipo.includes('servicio')) analytics[fecha].servicios++;
                if (tipo.includes('venta')) {
                    analytics[fecha].ventas++;
                    analytics[fecha].ingresos += datos.total || 0;
                }
                
                localStorage.setItem('analytics', JSON.stringify(analytics));
            }
            
            enviarNotificacion(tipo, datos) {
                const mensajes = {
                    'producto_agregado': 'Nuevo producto agregado exitosamente',
                    'servicio_agregado': 'Nuevo servicio agregado exitosamente',
                    'venta_realizada': `Venta realizada por $${datos.total || 0}`
                };
                
                if (mensajes[tipo]) {
                    mostrarAlerta(mensajes[tipo], 'success');
                }
            }
        }
        
        // ============================================
        // SISTEMA DE ANALYTICS
        // ============================================
        
        class SistemaAnalytics {
            constructor() {
                this.datos = JSON.parse(localStorage.getItem('analytics') || '{}');
                this.inicializar();
            }
            
            inicializar() {
                console.log('üìä Sistema de Analytics inicializado');
                this.configurarEventos();
            }
            
            configurarEventos() {
                // Rastrear interacciones
                document.addEventListener('click', (e) => {
                    this.rastrearInteraccion('click', e.target);
                });
                
                // Rastrear formularios
                document.addEventListener('submit', (e) => {
                    this.rastrearInteraccion('form_submit', e.target);
                });
            }
            
            rastrearInteraccion(tipo, elemento) {
                const datos = {
                    tipo: tipo,
                    elemento: elemento.tagName,
                    clase: elemento.className,
                    id: elemento.id,
                    timestamp: new Date().toISOString()
                };
                
                this.guardarDatos('interacciones', datos);
            }
            
            guardarDatos(categoria, datos) {
                if (!this.datos[categoria]) {
                    this.datos[categoria] = [];
                }
                
                this.datos[categoria].push(datos);
                localStorage.setItem('analytics', JSON.stringify(this.datos));
            }
            
            obtenerEstadisticas() {
                const fecha = new Date().toISOString().split('T')[0];
                return this.datos[fecha] || {
                    productos: 0,
                    servicios: 0,
                    ventas: 0,
                    ingresos: 0
                };
            }
        }
        
        // ============================================
        // SISTEMA DE PAGOS
        // ============================================
        
        class SistemaPagos {
            constructor() {
                this.configuracion = JSON.parse(localStorage.getItem('configuracionPagos') || '{}');
                this.inicializar();
            }
            
            inicializar() {
                console.log('üí≥ Sistema de Pagos inicializado');
                this.configurarMetodos();
            }
            
            configurarMetodos() {
                this.metodos = {
                    'efectivo': { nombre: 'Efectivo', comision: 0 },
                    'transferencia': { nombre: 'Transferencia', comision: 0 },
                    'mercadopago': { nombre: 'MercadoPago', comision: 0.035 },
                    'paypal': { nombre: 'PayPal', comision: 0.034 },
                    'stripe': { nombre: 'Stripe', comision: 0.029 }
                };
            }
            
            procesarPago(datos) {
                const metodo = this.metodos[datos.metodo];
                const comision = datos.monto * metodo.comision;
                const neto = datos.monto - comision;
                
                const pago = {
                    id: Date.now(),
                    monto: datos.monto,
                    metodo: datos.metodo,
                    comision: comision,
                    neto: neto,
                    fecha: new Date().toISOString(),
                    estado: 'pendiente'
                };
                
                this.guardarPago(pago);
                return pago;
            }
            
            guardarPago(pago) {
                const pagos = JSON.parse(localStorage.getItem('pagos') || '[]');
                pagos.push(pago);
                localStorage.setItem('pagos', JSON.stringify(pagos));
            }
        }
        
        // ============================================
        // SISTEMA DE NOTIFICACIONES
        // ============================================
        
        class SistemaNotificaciones {
            constructor() {
                this.notificaciones = JSON.parse(localStorage.getItem('notificaciones') || '[]');
                this.inicializar();
            }
            
            inicializar() {
                console.log('üîî Sistema de Notificaciones inicializado');
                this.configurarEventos();
            }
            
            configurarEventos() {
                // Notificar cambios importantes
                this.observarCambios();
            }
            
            observarCambios() {
                // Observar cambios en localStorage
                const originalSetItem = localStorage.setItem;
                localStorage.setItem = function(key, value) {
                    originalSetItem.call(this, key, value);
                    
                    if (key === 'productos' || key === 'servicios' || key === 'ventas') {
                        window.sistemaNotificaciones.crearNotificacion(`${key} actualizados`, 'info');
                    }
                };
            }
            
            crearNotificacion(mensaje, tipo = 'info') {
                const notificacion = {
                    id: Date.now(),
                    mensaje: mensaje,
                    tipo: tipo,
                    fecha: new Date().toISOString(),
                    leida: false
                };
                
                this.notificaciones.unshift(notificacion);
                localStorage.setItem('notificaciones', JSON.stringify(this.notificaciones));
                
                this.mostrarNotificacion(notificacion);
            }
            
            mostrarNotificacion(notificacion) {
                const alerta = document.createElement('div');
                alerta.className = `alert alert-${notificacion.tipo} alert-dismissible fade show`;
                alerta.style.position = 'fixed';
                alerta.style.top = '20px';
                alerta.style.right = '20px';
                alerta.style.zIndex = '10000';
                alerta.style.minWidth = '300px';
                
                alerta.innerHTML = `
                    ${notificacion.mensaje}
                    <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
                `;
                
                document.body.appendChild(alerta);
                
                setTimeout(() => {
                    if (alerta.parentElement) {
                        alerta.remove();
                    }
                }, 5000);
            }
        }
        
        // ============================================
        // SISTEMA DE SEGURIDAD
        // ============================================
        
        class SistemaSeguridad {
            constructor() {
                this.configuracion = JSON.parse(localStorage.getItem('configuracionSeguridad') || '{}');
                this.inicializar();
            }
            
            inicializar() {
                console.log('üîí Sistema de Seguridad inicializado');
                this.configurarEventos();
                this.verificarSeguridad();
            }
            
            configurarEventos() {
                // Prevenir clic derecho
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });
                
                // Prevenir F12
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                        e.preventDefault();
                    }
                });
                
                // Detectar intentos de inspecci√≥n
                setInterval(() => {
                    this.detectarInspeccion();
                }, 1000);
            }
            
            detectarInspeccion() {
                if (window.outerHeight - window.innerHeight > 200) {
                    console.warn('üö® Posible inspecci√≥n detectada');
                    this.crearAlertaSeguridad('Inspecci√≥n detectada');
                }
            }
            
            verificarSeguridad() {
                const config = {
                    clicDerecho: true,
                    f12: true,
                    inspeccion: true,
                    copia: false
                };
                
                localStorage.setItem('configuracionSeguridad', JSON.stringify(config));
            }
            
            crearAlertaSeguridad(mensaje) {
                const alerta = document.createElement('div');
                alerta.className = 'alert alert-danger';
                alerta.style.position = 'fixed';
                alerta.style.top = '50%';
                alerta.style.left = '50%';
                alerta.style.transform = 'translate(-50%, -50%)';
                alerta.style.zIndex = '10000';
                alerta.textContent = mensaje;
                
                document.body.appendChild(alerta);
                
                setTimeout(() => {
                    alerta.remove();
                }, 3000);
            }
        }
        
        // ============================================
        // SISTEMA DE NAVEGACI√ìN
        // ============================================
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        function mostrarSeccion(seccion) {
            // Ocultar todas las secciones
            const secciones = document.querySelectorAll('.content-section');
            secciones.forEach(sec => sec.classList.add('hidden'));
            
            // Mostrar la secci√≥n seleccionada
            const seccionSeleccionada = document.getElementById(seccion);
            if (seccionSeleccionada) {
                seccionSeleccionada.classList.remove('hidden');
            }
            
            // Actualizar navegaci√≥n activa
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            const linkActivo = document.querySelector(`[onclick="mostrarSeccion('${seccion}')"]`);
            if (linkActivo) {
                linkActivo.classList.add('active');
            }
            
            // Cargar datos espec√≠ficos seg√∫n la secci√≥n
            switch(seccion) {
                case 'historial':
                    cargarHistorialSesiones();
                    cargarHistorialVentas();
                    cargarHistorialTurnos();
                    cargarFeedbacksCompradores();
                    break;
                case 'ventas':
                    const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
                    actualizarListaVentas(ventas);
                    break;
                case 'configuracion':
                    cargarConfiguracionEnvios();
                    cargarUltimoCambioPassword();
                    break;
                case 'metricas':
                    cargarMetricas();
                    break;
            }
        }

        // ============================================
        // SISTEMA DE M√âTRICAS Y ANAL√çTICAS
        // ============================================
        
        // Mensajes motivacionales positivos
        const mensajesMotivacionales = [
            {
                titulo: "¬°Excelente trabajo!",
                mensaje: "Cada d√≠a es una nueva oportunidad para crecer. ¬°Sigue as√≠!",
                icono: "fas fa-heart"
            },
            {
                titulo: "¬°Vas por buen camino!",
                mensaje: "Los emprendedores exitosos como t√∫ siempre encuentran la manera de mejorar.",
                icono: "fas fa-star"
            },
            {
                titulo: "¬°Incre√≠ble progreso!",
                mensaje: "Cada venta es un paso m√°s hacia tus sue√±os. ¬°No te detengas!",
                icono: "fas fa-rocket"
            },
            {
                titulo: "¬°Sigue adelante!",
                mensaje: "Los d√≠as dif√≠ciles son temporales, pero tu determinaci√≥n es permanente.",
                icono: "fas fa-sun"
            },
            {
                titulo: "¬°Eres un campe√≥n!",
                mensaje: "Cada desaf√≠o es una oportunidad de oro para brillar a√∫n m√°s.",
                icono: "fas fa-trophy"
            }
        ];
        
        const consejosDelDia = [
            "Mant√©n siempre un inventario actualizado para no perder ventas.",
            "Las fotos de calidad pueden aumentar tus ventas hasta un 30%.",
            "Responde r√°pido a los mensajes de clientes - la atenci√≥n al cliente es clave.",
            "Promociona tus productos en redes sociales para llegar a m√°s personas.",
            "Ofrece descuentos por compras m√∫ltiples para aumentar el ticket promedio.",
            "Mant√©n precios competitivos pero que te permitan ganar.",
            "S√© honesto en las descripciones - la confianza genera ventas.",
            "Actualiza regularmente tu cat√°logo con productos nuevos.",
            "Pide feedback a tus clientes para mejorar continuamente.",
            "Celebra cada venta, por peque√±a que sea - ¬°cada una cuenta!"
        ];
        
        function actualizarMensajeMotivacional() {
            const mensaje = mensajesMotivacionales[Math.floor(Math.random() * mensajesMotivacionales.length)];
            document.getElementById('tituloMotivacional').textContent = mensaje.titulo;
            document.getElementById('mensajeMotivacionalTexto').textContent = mensaje.mensaje;
            document.querySelector('#mensajeMotivacional i').className = `${mensaje.icono} text-primary fa-2x`;
        }
        
        function actualizarConsejoDelDia() {
            const consejo = consejosDelDia[Math.floor(Math.random() * consejosDelDia.length)];
            document.getElementById('consejoDelDia').textContent = consejo;
        }
        
        function cargarMetricas() {
            // Cargar datos desde localStorage
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            const productos = JSON.parse(localStorage.getItem('productos') || '[]');
            const servicios = JSON.parse(localStorage.getItem('servicios') || '[]');
            const feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
            
            // Calcular m√©tricas
            const totalVentas = ventas.reduce((sum, venta) => sum + (venta.precio * venta.cantidad), 0);
            const totalProductosVendidos = ventas.reduce((sum, venta) => sum + venta.cantidad, 0);
            const clientesUnicos = new Set(ventas.map(v => v.cliente)).size;
            const satisfaccionPromedio = feedbacks.length > 0 ? 
                (feedbacks.reduce((sum, f) => sum + f.calificacion, 0) / feedbacks.length).toFixed(1) : 0;
            
            // Actualizar m√©tricas principales
            document.getElementById('totalVentasMetricas').textContent = `$${totalVentas.toLocaleString()}`;
            document.getElementById('productosVendidos').textContent = totalProductosVendidos;
            document.getElementById('clientesNuevos').textContent = clientesUnicos;
            document.getElementById('satisfaccionPromedio').textContent = satisfaccionPromedio;
            
            // Calcular tendencias (simuladas)
            const tendenciaVentas = Math.random() > 0.3 ? `+${Math.floor(Math.random() * 50) + 10}%` : `-${Math.floor(Math.random() * 20) + 5}%`;
            const tendenciaProductos = Math.random() > 0.3 ? `+${Math.floor(Math.random() * 30) + 5}%` : `-${Math.floor(Math.random() * 15) + 3}%`;
            const tendenciaClientes = Math.random() > 0.3 ? `+${Math.floor(Math.random() * 40) + 8}%` : `-${Math.floor(Math.random() * 10) + 2}%`;
            
            document.getElementById('tendenciaVentas').textContent = `${tendenciaVentas} vs mes anterior`;
            document.getElementById('tendenciaProductos').textContent = `${tendenciaProductos} vs mes anterior`;
            document.getElementById('tendenciaClientes').textContent = `${tendenciaClientes} vs mes anterior`;
            
            // An√°lisis avanzado (solo para planes pagos)
            const plan = localStorage.getItem('planActual') || 'gratuito';
            if (plan !== 'gratuito') {
                document.getElementById('analisisAvanzado').style.display = 'block';
                document.getElementById('restriccionMetricas').style.display = 'none';
                
                // Calcular m√©tricas avanzadas
                const tasaConversion = Math.floor(Math.random() * 15) + 5; // 5-20%
                const valorPromedioTicket = totalVentas / Math.max(ventas.length, 1);
                const tasaRetencion = Math.floor(Math.random() * 30) + 20; // 20-50%
                
                document.getElementById('tasaConversion').textContent = `${tasaConversion}%`;
                document.getElementById('valorPromedioTicket').textContent = `$${valorPromedioTicket.toFixed(0)}`;
                document.getElementById('tasaRetencion').textContent = `${tasaRetencion}%`;
            } else {
                document.getElementById('analisisAvanzado').style.display = 'none';
                document.getElementById('restriccionMetricas').style.display = 'block';
            }
            
            // Actualizar objetivos
            actualizarObjetivos(totalVentas, clientesUnicos, satisfaccionPromedio);
            
            // Actualizar mensajes motivacionales
            actualizarMensajeMotivacional();
            actualizarConsejoDelDia();
        }
        
        function actualizarObjetivos(ventas, clientes, satisfaccion) {
            // Objetivo de ventas: $1000
            const objetivoVentas = 1000;
            const progresoVentas = Math.min((ventas / objetivoVentas) * 100, 100);
            document.getElementById('progresoVentas').textContent = `${ventas}/${objetivoVentas}`;
            document.getElementById('barraProgresoVentas').style.width = `${progresoVentas}%`;
            
            // Objetivo de clientes: 50
            const objetivoClientes = 50;
            const progresoClientes = Math.min((clientes / objetivoClientes) * 100, 100);
            document.getElementById('progresoClientes').textContent = `${clientes}/${objetivoClientes}`;
            document.getElementById('barraProgresoClientes').style.width = `${progresoClientes}%`;
            
            // Objetivo de satisfacci√≥n: 5 estrellas
            const objetivoSatisfaccion = 5;
            const progresoSatisfaccion = (satisfaccion / objetivoSatisfaccion) * 100;
            document.getElementById('progresoSatisfaccion').textContent = `${satisfaccion}/${objetivoSatisfaccion}`;
            document.getElementById('barraProgresoSatisfaccion').style.width = `${progresoSatisfaccion}%`;
        }
        
        // ============================================
        // FUNCIONES PARA NUEVOS MODALES
        // ============================================
        
        function guardarConfiguracionBot() {
            const configuracion = {
                nombre: document.getElementById('nombreBot').value,
                mensajeBienvenida: document.getElementById('mensajeBienvenidaBot').value,
                horarioDesde: document.getElementById('horarioDesde').value,
                horarioHasta: document.getElementById('horarioHasta').value,
                mensajeFueraHorario: document.getElementById('mensajeFueraHorario').value
            };
            
            localStorage.setItem('configuracionBot', JSON.stringify(configuracion));
            sistemaNotificaciones.mostrar('Configuraci√≥n del bot guardada', 'success');
            cerrarModal('modalChatbot');
        }
        
        function guardarConfiguracionSoporte() {
            const configuracion = {
                email: document.getElementById('emailSoporte').value,
                whatsapp: document.getElementById('whatsappSoporte').value,
                telefono: document.getElementById('telefonoSoporte').value,
                direccion: document.getElementById('direccionSoporte').value,
                horarioDesde: document.getElementById('soporteDesde').value,
                horarioHasta: document.getElementById('soporteHasta').value
            };
            
            localStorage.setItem('configuracionSoporte', JSON.stringify(configuracion));
            sistemaNotificaciones.mostrar('Configuraci√≥n de soporte guardada', 'success');
            cerrarModal('modalSoporte');
        }
        
        function previewLogoDiseno(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewLogoDiseno').innerHTML = 
                        `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function previewPortadaDiseno(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewPortadaDiseno').innerHTML = 
                        `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 100px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function guardarDiseno() {
            const diseno = {
                nombreTienda: document.getElementById('nombreTiendaDiseno').value,
                descripcion: document.getElementById('descripcionTiendaDiseno').value,
                colorPrincipal: document.getElementById('colorPrincipalDiseno').value,
                colorSecundario: document.getElementById('colorSecundarioDiseno').value
            };
            
            localStorage.setItem('disenoTienda', JSON.stringify(diseno));
            sistemaNotificaciones.mostrar('Dise√±o guardado exitosamente', 'success');
            cerrarModal('modalDiseno');
        }
        
        // ============================================
        // SISTEMA DE MODALES
        // ============================================
        
        function abrirModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
                
                // Aplicar clase compact a todos los modales
                const modalContent = modal.querySelector('.modal-content');
                if (modalContent) {
                    modalContent.classList.add('compact');
                }
            }
        }

        function cerrarModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        }

        // Cerrar modal al hacer clic fuera
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                cerrarModal(e.target.id);
            }
        });

        // ============================================
        // SISTEMA DE DATOS
        // ============================================
        
        let productos = JSON.parse(localStorage.getItem('productos') || '[]');
        let servicios = JSON.parse(localStorage.getItem('servicios') || '[]');
        let turnos = JSON.parse(localStorage.getItem('turnos') || '[]');
        let ventas = JSON.parse(localStorage.getItem('ventas') || '[]');

        function actualizarEstadisticas() {
            document.getElementById('totalProductos').textContent = productos.length;
            document.getElementById('totalServicios').textContent = servicios.length;
            document.getElementById('totalVentas').textContent = ventas.length;
            
            const totalIngresos = ventas.reduce((sum, venta) => sum + venta.total, 0);
            document.getElementById('totalIngresos').textContent = `$${totalIngresos.toFixed(2)}`;
        }

        function cargarProductos() {
            const lista = document.getElementById('listaProductos');
            if (productos.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay productos registrados</p>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Nombre</th><th>Precio</th><th>Stock</th><th>Categor√≠a</th><th>Acciones</th></tr></thead><tbody>';
            
            productos.forEach((producto, index) => {
                html += `
                    <tr>
                        <td>${producto.nombre}</td>
                        <td>$${producto.precio}</td>
                        <td>${producto.stock}</td>
                        <td><span class="badge badge-success">${producto.categoria}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editarProducto(${index})">Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarProducto(${index})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            lista.innerHTML = html;
        }

        function cargarServicios() {
            const lista = document.getElementById('listaServicios');
            if (servicios.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay servicios registrados</p>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Nombre</th><th>Precio</th><th>Duraci√≥n</th><th>Categor√≠a</th><th>Acciones</th></tr></thead><tbody>';
            
            servicios.forEach((servicio, index) => {
                html += `
                    <tr>
                        <td>${servicio.nombre}</td>
                        <td>$${servicio.precio}</td>
                        <td>${servicio.duracion} min</td>
                        <td><span class="badge badge-success">${servicio.categoria}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editarServicio(${index})">Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarServicio(${index})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            lista.innerHTML = html;
        }

        // ============================================
        // FORMULARIOS
        // ============================================
        
        const formProducto = document.getElementById('formProducto');
        if (formProducto) {
            formProducto.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const producto = {
                    nombre: formData.get('nombre'),
                    descripcion: formData.get('descripcion'),
                    precio: parseFloat(formData.get('precio')),
                    stock: parseInt(formData.get('stock')),
                    categoria: formData.get('categoria'),
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!producto.nombre || !producto.precio) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                productos.push(producto);
                localStorage.setItem('productos', JSON.stringify(productos));
                
                cargarProductos();
                actualizarEstadisticas();
                cerrarModal('modalProducto');
                this.reset();
                
                mostrarAlerta('Producto agregado exitosamente', 'success');
            });
        }

        const formServicio = document.getElementById('formServicio');
        if (formServicio) {
            formServicio.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const servicio = {
                    nombre: formData.get('nombre'),
                    descripcion: formData.get('descripcion'),
                    precio: parseFloat(formData.get('precio')),
                    duracion: parseInt(formData.get('duracion')),
                    categoria: formData.get('categoria'),
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!servicio.nombre || !servicio.precio) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                servicios.push(servicio);
                localStorage.setItem('servicios', JSON.stringify(servicios));
                
                cargarServicios();
                actualizarEstadisticas();
                cerrarModal('modalServicio');
                this.reset();
                
                mostrarAlerta('Servicio agregado exitosamente', 'success');
            });
        }

        const formTurno = document.getElementById('formTurno');
        if (formTurno) {
            formTurno.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const turno = {
                    dia: formData.get('dia'),
                    horaInicio: formData.get('horaInicio'),
                    horaFin: formData.get('horaFin'),
                    duracion: parseInt(formData.get('duracion')),
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!turno.dia || !turno.horaInicio || !turno.horaFin) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                turnos.push(turno);
                localStorage.setItem('turnos', JSON.stringify(turnos));
                
                cerrarModal('modalTurno');
                this.reset();
                
                mostrarAlerta('Configuraci√≥n de turnos guardada', 'success');
            });
        }

        const formVenta = document.getElementById('formVenta');
        if (formVenta) {
            formVenta.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const venta = {
                    cliente: formData.get('cliente'),
                    item: formData.get('item'),
                    cantidad: parseInt(formData.get('cantidad')),
                    metodoPago: formData.get('metodoPago'),
                    total: parseFloat(formData.get('total')),
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!venta.cliente || !venta.item || !venta.total) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                ventas.push(venta);
                localStorage.setItem('ventas', JSON.stringify(ventas));
                
                // Notificar interconexi√≥n
                if (window.sistemaInterconexiones) {
                    window.sistemaInterconexiones.notificarInterconexion('venta_realizada', venta);
                }
                
                cargarVentas();
                actualizarEstadisticas();
                cerrarModal('modalVenta');
                this.reset();
                
                mostrarAlerta('Venta registrada exitosamente', 'success');
            });
        }

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        
        function mostrarAlerta(mensaje, tipo) {
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo}`;
            alerta.textContent = mensaje;
            
            document.body.appendChild(alerta);
            
            setTimeout(() => {
                alerta.remove();
            }, 3000);
        }

        function guardarConfiguracion() {
            const nombreTienda = document.getElementById('nombreTienda').value;
            const emailTienda = document.getElementById('emailTienda').value;
            
            localStorage.setItem('configuracionTienda', JSON.stringify({
                nombre: nombreTienda,
                email: emailTienda
            }));
            
            mostrarAlerta('Configuraci√≥n guardada exitosamente', 'success');
        }

        function eliminarProducto(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                productos.splice(index, 1);
                localStorage.setItem('productos', JSON.stringify(productos));
                cargarProductos();
                actualizarEstadisticas();
                mostrarAlerta('Producto eliminado', 'info');
            }
        }

        function eliminarServicio(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este servicio?')) {
                servicios.splice(index, 1);
                localStorage.setItem('servicios', JSON.stringify(servicios));
                cargarServicios();
                actualizarEstadisticas();
                mostrarAlerta('Servicio eliminado', 'info');
            }
        }

        function cargarVentas() {
            const lista = document.getElementById('listaVentas');
            if (ventas.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay ventas registradas</p>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Cliente</th><th>Item</th><th>Cantidad</th><th>Total</th><th>M√©todo</th><th>Fecha</th><th>Acciones</th></tr></thead><tbody>';
            
            ventas.forEach((venta, index) => {
                html += `
                    <tr>
                        <td>${venta.cliente}</td>
                        <td>${venta.item}</td>
                        <td>${venta.cantidad}</td>
                        <td>$${venta.total}</td>
                        <td><span class="badge badge-info">${venta.metodoPago}</span></td>
                        <td>${new Date(venta.fecha).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="eliminarVenta(${index})">Eliminar</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            lista.innerHTML = html;
        }

        function eliminarVenta(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta venta?')) {
                ventas.splice(index, 1);
                localStorage.setItem('ventas', JSON.stringify(ventas));
                cargarVentas();
                actualizarEstadisticas();
                mostrarAlerta('Venta eliminada', 'info');
            }
        }

        function mostrarBackups() {
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            if (backups.length === 0) {
                mostrarAlerta('No hay backups disponibles', 'info');
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table"><thead><tr><th>Fecha</th><th>Productos</th><th>Servicios</th><th>Ventas</th><th>Acciones</th></tr></thead><tbody>';
            
            backups.forEach((backup, index) => {
                html += `
                    <tr>
                        <td>${new Date(backup.fecha).toLocaleString()}</td>
                        <td>${backup.productos.length}</td>
                        <td>${backup.servicios.length}</td>
                        <td>${backup.ventas.length}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="sistemaBackup.restaurarBackup('${backup.fecha}')">Restaurar</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Backups Disponibles</h3>
                        <button class="modal-close" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${html}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ============================================
        // SISTEMA DE IM√ÅGENES
        // ============================================
        
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewImages(input) {
            const preview = document.getElementById('productoImagePreview');
            preview.innerHTML = '';
            
            if (input.files) {
                Array.from(input.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'img-thumbnail me-2 mb-2';
                        img.style.maxWidth = '150px';
                        img.style.maxHeight = '150px';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }

        // ============================================
        // SISTEMA DE BIENESTAR EMOCIONAL
        // ============================================
        
        function actualizarEstadoAnimo(estado) {
            const estados = {
                'feliz': { emoji: 'üòä', color: 'success', mensaje: '¬°Excelente! Mant√©n esa energ√≠a positiva.' },
                'neutral': { emoji: 'üòê', color: 'info', mensaje: 'Todo bien. Recuerda que cada d√≠a es una nueva oportunidad.' },
                'triste': { emoji: 'üò¢', color: 'warning', mensaje: 'Es normal sentirse as√≠. Recuerda que no est√°s solo.' }
            };
            
            const estadoData = estados[estado];
            localStorage.setItem('estadoAnimo', JSON.stringify({
                estado: estado,
                fecha: new Date().toISOString(),
                mensaje: estadoData.mensaje
            }));
            
            mostrarAlerta(`${estadoData.emoji} ${estadoData.mensaje}`, estadoData.color);
            cargarConsejoBienestar();
        }

        function cargarConsejoBienestar() {
            const consejos = [
                "üí° Recuerda: cada emprendedor exitoso empez√≥ con un sue√±o como el tuyo.",
                "üåü La constancia es la clave del √©xito. No te rindas.",
                "üí™ Cada desaf√≠o es una oportunidad de crecer y aprender.",
                "üéØ Enf√≥cate en un objetivo a la vez. La paciencia es tu aliada.",
                "ü§ù Rod√©ate de personas que te apoyen y crean en tu proyecto.",
                "üìö Aprende algo nuevo cada d√≠a. El conocimiento es poder.",
                "üé® La creatividad es tu ventaja competitiva. √ösala.",
                "üíñ Cuida tu bienestar mental. Un emprendedor feliz es m√°s productivo."
            ];
            
            const consejo = consejos[Math.floor(Math.random() * consejos.length)];
            document.getElementById('consejoBienestar').innerHTML = `<p class="alert alert-info">${consejo}</p>`;
        }

        // ============================================
        // CHATBOT IA
        // ============================================
        
        function enviarMensaje() {
            const input = document.getElementById('chatInput');
            const mensaje = input.value.trim();
            
            if (!mensaje) return;
            
            const chatContainer = document.getElementById('chatContainer');
            
            // Agregar mensaje del usuario
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user-message text-end mb-2';
            userMessage.innerHTML = `<strong>T√∫:</strong> ${mensaje}`;
            chatContainer.appendChild(userMessage);
            
            // Limpiar input
            input.value = '';
            
            // Simular respuesta del bot
            setTimeout(() => {
                const botResponse = generarRespuestaBot(mensaje);
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot-message mb-2';
                botMessage.innerHTML = `<strong>CRESALIA BOT:</strong> ${botResponse}`;
                chatContainer.appendChild(botMessage);
                
                // Scroll al final
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 1000);
        }

        function generarRespuestaBot(mensaje) {
            const respuestas = {
                'hola': '¬°Hola! ¬øEn qu√© puedo ayudarte con tu tienda hoy?',
                'ayuda': 'Estoy aqu√≠ para ayudarte. Puedo ayudarte con productos, servicios, ventas, configuraci√≥n y m√°s.',
                'producto': 'Para agregar un producto, ve a la secci√≥n "Productos" y haz clic en "Agregar Producto".',
                'servicio': 'Para agregar un servicio, ve a la secci√≥n "Servicios" y haz clic en "Agregar Servicio".',
                'venta': 'Para registrar una venta, ve a la secci√≥n "Ventas" y haz clic en "Nueva Venta".',
                'configuracion': 'Para configurar tu tienda, ve a la secci√≥n "Configuraci√≥n".',
                'precio': 'Los precios los defines t√∫. Puedes ajustarlos seg√∫n tu mercado y competencia.',
                'pago': 'Aceptamos m√∫ltiples m√©todos de pago: efectivo, transferencia, MercadoPago, PayPal.',
                'soporte': 'Para soporte t√©cnico, ve a la secci√≥n "Soporte" o contacta a nuestro equipo.'
            };
            
            const mensajeLower = mensaje.toLowerCase();
            for (const [palabra, respuesta] of Object.entries(respuestas)) {
                if (mensajeLower.includes(palabra)) {
                    return respuesta;
                }
            }
            
            return 'Entiendo tu consulta. ¬øPodr√≠as ser m√°s espec√≠fico? Puedo ayudarte con productos, servicios, ventas, configuraci√≥n y m√°s.';
        }

        // ============================================
        // SISTEMA DE SUSCRIPCIONES
        // ============================================
        
        function cambiarPlan(plan) {
            const planes = {
                'basico': { precio: 29, nombre: 'Plan B√°sico' },
                'premium': { precio: 99, nombre: 'Plan Premium' }
            };
            
            const planData = planes[plan];
            if (confirm(`¬øEst√°s seguro de que quieres cambiar al ${planData.nombre} por $${planData.precio}/mes?`)) {
                localStorage.setItem('planActual', JSON.stringify({
                    plan: plan,
                    precio: planData.precio,
                    fecha: new Date().toISOString(),
                    activo: true
                }));
                
                mostrarAlerta(`Plan actualizado a ${planData.nombre}`, 'success');
                actualizarEstadisticas();
            }
        }

        // ============================================
        // FORMULARIOS ADICIONALES
        // ============================================
        
        const formOferta = document.getElementById('formOferta');
        if (formOferta) {
            formOferta.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const oferta = {
                    titulo: formData.get('titulo'),
                    descripcion: formData.get('descripcion'),
                    descuento: parseInt(formData.get('descuento')),
                    vencimiento: formData.get('vencimiento'),
                    imagen: formData.get('imagen').name,
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!oferta.titulo || !oferta.descuento) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                const ofertas = JSON.parse(localStorage.getItem('ofertas') || '[]');
                ofertas.push(oferta);
                localStorage.setItem('ofertas', JSON.stringify(ofertas));
                
                cargarOfertas();
                cerrarModal('modalOferta');
                this.reset();
                
                mostrarAlerta('Oferta creada exitosamente', 'success');
            });
        }

        const formContacto = document.getElementById('formContacto');
        if (formContacto) {
            formContacto.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const contacto = {
                    email: formData.get('email'),
                    whatsapp: formData.get('whatsapp'),
                    telefono: formData.get('telefono'),
                    direccion: formData.get('direccion'),
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!contacto.email) {
                    mostrarAlerta('Por favor completa el campo obligatorio (email)', 'error');
                    return;
                }
                
                localStorage.setItem('contacto', JSON.stringify(contacto));
                mostrarAlerta('Informaci√≥n de contacto guardada', 'success');
            });
        }

        function cargarOfertas() {
            const lista = document.getElementById('listaOfertas');
            const ofertas = JSON.parse(localStorage.getItem('ofertas') || '[]');
            
            if (ofertas.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay ofertas creadas</p>';
                return;
            }
            
            let html = '<div class="row">';
            ofertas.forEach((oferta, index) => {
                html += `
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${oferta.titulo}</h5>
                                <p class="card-text">${oferta.descripcion}</p>
                                <p class="text-success"><strong>${oferta.descuento}% de descuento</strong></p>
                                <p class="text-muted">Vence: ${new Date(oferta.vencimiento).toLocaleDateString()}</p>
                                <button class="btn btn-sm btn-danger" onclick="eliminarOferta(${index})">Eliminar</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            lista.innerHTML = html;
        }

        function eliminarOferta(index) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta oferta?')) {
                const ofertas = JSON.parse(localStorage.getItem('ofertas') || '[]');
                ofertas.splice(index, 1);
                localStorage.setItem('ofertas', JSON.stringify(ofertas));
                cargarOfertas();
                mostrarAlerta('Oferta eliminada', 'info');
            }
        }

        // ============================================
        // SISTEMA DE PLANES Y RESTRICCIONES
        // ============================================
        
        function verificarPlan() {
            const planActual = JSON.parse(localStorage.getItem('planActual') || '{"plan": "gratuito", "precio": 0}');
            return planActual.plan;
        }

        function mostrarRestriccionesPlan() {
            const plan = verificarPlan();
            
            // Mostrar/ocultar funciones seg√∫n el plan
            if (plan === 'gratuito') {
                document.getElementById('configuracionAvanzadaBot').style.display = 'none';
                document.getElementById('restriccionBot').style.display = 'block';
                document.getElementById('btnEditarFAQ').style.display = 'none';
                document.getElementById('restriccionFAQ').style.display = 'block';
                document.getElementById('btnConfigurarCrisla').style.display = 'none';
                document.getElementById('restriccionCrisla').style.display = 'block';
                document.getElementById('restriccionPersonalizacion').style.display = 'block';
            } else {
                document.getElementById('configuracionAvanzadaBot').style.display = 'block';
                document.getElementById('restriccionBot').style.display = 'none';
                document.getElementById('btnEditarFAQ').style.display = 'block';
                document.getElementById('restriccionFAQ').style.display = 'none';
                document.getElementById('btnConfigurarCrisla').style.display = 'block';
                document.getElementById('restriccionCrisla').style.display = 'none';
                document.getElementById('restriccionPersonalizacion').style.display = 'none';
            }
        }

        // ============================================
        // SISTEMA DE PERSONALIZACI√ìN VISUAL
        // ============================================
        
        function aplicarColorPersonalizado() {
            const colorPrincipal = document.getElementById('colorPrincipal').value;
            const colorSecundario = document.getElementById('colorSecundario').value;
            
            document.documentElement.style.setProperty('--primary-color', colorPrincipal);
            document.documentElement.style.setProperty('--secondary-color', colorSecundario);
            
            // Guardar configuraci√≥n
            localStorage.setItem('coloresPersonalizados', JSON.stringify({
                principal: colorPrincipal,
                secundario: colorSecundario
            }));
        }

        function previewLogo(input) {
            const preview = document.getElementById('logoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewVideo(input) {
            const preview = document.getElementById('videoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <video controls style="max-width: 300px; max-height: 200px;">
                            <source src="${e.target.result}" type="video/mp4">
                            Tu navegador no soporta videos.
                        </video>
                    `;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewImagenPortada(input) {
            const preview = document.getElementById('portadaPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 300px; max-height: 200px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ============================================
        // CHAT CON CRISLA
        // ============================================
        
        function enviarMensajeCrisla() {
            const input = document.getElementById('crislaInput');
            const mensaje = input.value.trim();
            
            if (!mensaje) return;
            
            const chatContainer = document.getElementById('chatCrislaContainer');
            
            // Agregar mensaje del usuario
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user-message text-end mb-2';
            userMessage.innerHTML = `<strong>T√∫:</strong> ${mensaje}`;
            chatContainer.appendChild(userMessage);
            
            // Limpiar input
            input.value = '';
            
            // Simular respuesta de CRISLA
            setTimeout(() => {
                const crislaResponse = generarRespuestaCrisla(mensaje);
                const crislaMessage = document.createElement('div');
                crislaMessage.className = 'chat-message crisla-message mb-2';
                crislaMessage.innerHTML = `<strong>üíú CRISLA:</strong> ${crislaResponse}`;
                chatContainer.appendChild(crislaMessage);
                
                // Scroll al final
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 1000);
        }

        function generarRespuestaCrisla(mensaje) {
            const configCrisla = JSON.parse(localStorage.getItem('configuracionCrisla') || '{}');
            const mensajeLower = mensaje.toLowerCase();
            
            // Respuestas personalizadas si est√°n configuradas
            if (configCrisla.feliz && (mensajeLower.includes('feliz') || mensajeLower.includes('bien'))) {
                return configCrisla.feliz;
            }
            if (configCrisla.triste && (mensajeLower.includes('triste') || mensajeLower.includes('mal'))) {
                return configCrisla.triste;
            }
            if (configCrisla.neutral && (mensajeLower.includes('normal') || mensajeLower.includes('regular'))) {
                return configCrisla.neutral;
            }
            
            // Respuestas por defecto
            const respuestas = [
                "üíú Entiendo perfectamente. Estoy aqu√≠ para apoyarte en todo momento.",
                "üíú Recuerda que eres m√°s fuerte de lo que crees. Juntos podemos superar cualquier desaf√≠o.",
                "üíú Cada emprendedor exitoso pas√≥ por momentos dif√≠ciles. T√∫ tambi√©n puedes lograrlo.",
                "üíú Tu bienestar es importante. ¬øHay algo espec√≠fico en lo que pueda ayudarte?",
                "üíú Estoy orgullosa de tu valent√≠a. Sigue adelante con tu proyecto.",
                "üíú Los sue√±os requieren tiempo y paciencia. No te rindas.",
                "üíú Eres incre√≠ble por seguir luchando. CRISLA cree en ti."
            ];
            
            return respuestas[Math.floor(Math.random() * respuestas.length)];
        }

        // ============================================
        // FORMULARIOS ADICIONALES
        // ============================================
        
        const formFAQ = document.getElementById('formFAQ');
        if (formFAQ) {
            formFAQ.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Actualizar FAQ
                for (let i = 1; i <= 5; i++) {
                    const preguntaElement = document.getElementById(`faq-pregunta-${i}-edit`);
                    const respuestaElement = document.getElementById(`faq-respuesta-${i}-edit`);
                    
                    if (preguntaElement && respuestaElement) {
                        const pregunta = preguntaElement.value;
                        const respuesta = respuestaElement.value;
                        
                        const preguntaDisplay = document.getElementById(`faq-pregunta-${i}`);
                        const respuestaDisplay = document.getElementById(`faq-respuesta-${i}`);
                        
                        if (preguntaDisplay && respuestaDisplay) {
                            preguntaDisplay.textContent = pregunta;
                            respuestaDisplay.textContent = respuesta;
                        }
                    }
                }
                
                // Guardar configuraci√≥n
                const faqConfig = {};
                for (let i = 1; i <= 5; i++) {
                    const preguntaElement = document.getElementById(`faq-pregunta-${i}-edit`);
                    const respuestaElement = document.getElementById(`faq-respuesta-${i}-edit`);
                    
                    if (preguntaElement && respuestaElement) {
                        faqConfig[`pregunta${i}`] = preguntaElement.value;
                        faqConfig[`respuesta${i}`] = respuestaElement.value;
                    }
                }
                localStorage.setItem('faqPersonalizado', JSON.stringify(faqConfig));
                
                cerrarModal('modalFAQ');
                mostrarAlerta('FAQ actualizado exitosamente', 'success');
            });
        }

        const formCrisla = document.getElementById('formCrisla');
        if (formCrisla) {
            formCrisla.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const configCrisla = {
                    bienvenida: document.getElementById('crisla-bienvenida').value,
                    feliz: document.getElementById('crisla-feliz').value,
                    neutral: document.getElementById('crisla-neutral').value,
                    triste: document.getElementById('crisla-triste').value
                };
                
                // Validaci√≥n b√°sica
                if (!configCrisla.bienvenida) {
                    mostrarAlerta('Por favor completa el mensaje de bienvenida', 'error');
                    return;
                }
                
                localStorage.setItem('configuracionCrisla', JSON.stringify(configCrisla));
                
                // Actualizar mensaje de bienvenida
                const chatContainer = document.getElementById('chatCrislaContainer');
                const mensajeBienvenida = chatContainer.querySelector('.crisla-message');
                if (mensajeBienvenida) {
                    mensajeBienvenida.innerHTML = `<strong>üíú CRISLA:</strong> ${configCrisla.bienvenida}`;
                }
                
                cerrarModal('modalCrisla');
                mostrarAlerta('CRISLA configurado exitosamente', 'success');
            });
        }

        function guardarConfiguracionBot() {
            const configBot = {
                bienvenida: document.getElementById('mensajeBienvenida').value,
                defecto: document.getElementById('respuestaDefecto').value
            };
            
            localStorage.setItem('configuracionBot', JSON.stringify(configBot));
            mostrarAlerta('Configuraci√≥n del bot guardada', 'success');
        }

        function cargarConfiguracionesGuardadas() {
            // Cargar colores personalizados
            const colores = JSON.parse(localStorage.getItem('coloresPersonalizados') || '{}');
            if (colores.principal) {
                document.getElementById('colorPrincipal').value = colores.principal;
                document.documentElement.style.setProperty('--primary-color', colores.principal);
            }
            if (colores.secundario) {
                document.getElementById('colorSecundario').value = colores.secundario;
                document.documentElement.style.setProperty('--secondary-color', colores.secundario);
            }
            
            // Cargar configuraci√≥n de CRISLA
            const configCrisla = JSON.parse(localStorage.getItem('configuracionCrisla') || '{}');
            if (configCrisla.bienvenida) {
                document.getElementById('crisla-bienvenida').value = configCrisla.bienvenida;
            }
            if (configCrisla.feliz) {
                document.getElementById('crisla-feliz').value = configCrisla.feliz;
            }
            if (configCrisla.neutral) {
                document.getElementById('crisla-neutral').value = configCrisla.neutral;
            }
            if (configCrisla.triste) {
                document.getElementById('crisla-triste').value = configCrisla.triste;
            }
            
            // Cargar FAQ personalizado
            const faqPersonalizado = JSON.parse(localStorage.getItem('faqPersonalizado') || '{}');
            for (let i = 1; i <= 5; i++) {
                if (faqPersonalizado[`pregunta${i}`]) {
                    document.getElementById(`faq-pregunta-${i}`).textContent = faqPersonalizado[`pregunta${i}`];
                    document.getElementById(`faq-respuesta-${i}`).textContent = faqPersonalizado[`respuesta${i}`];
                }
            }
            
            // Cargar configuraci√≥n del bot
            const configBot = JSON.parse(localStorage.getItem('configuracionBot') || '{}');
            if (configBot.bienvenida) {
                document.getElementById('mensajeBienvenida').value = configBot.bienvenida;
            }
            if (configBot.defecto) {
                document.getElementById('respuestaDefecto').value = configBot.defecto;
            }
            
            // Cargar feedbacks
            cargarFeedbacks();
        }

        // ============================================
        // SISTEMA DE USUARIOS NUEVOS Y BIENESTAR
        // ============================================
        
        function verificarUsuarioNuevo() {
            const productos = JSON.parse(localStorage.getItem('productos') || '[]');
            const servicios = JSON.parse(localStorage.getItem('servicios') || '[]');
            
            // Verificar que los elementos existan antes de acceder a ellos
            const menuBienestar = document.getElementById('menuBienestar');
            const seccionBienestar = document.getElementById('bienestar');
            
            if (!menuBienestar || !seccionBienestar) {
                console.log('Elementos de bienestar no encontrados');
                return;
            }
            
            // Si tiene menos de 3 productos y 2 servicios, es usuario nuevo
            if (productos.length < 3 && servicios.length < 2) {
                menuBienestar.style.display = 'block';
                seccionBienestar.style.display = 'block';
                console.log('Usuario nuevo detectado - mostrando bienestar');
            } else {
                menuBienestar.style.display = 'none';
                seccionBienestar.style.display = 'none';
                console.log('Usuario avanzado - ocultando bienestar');
            }
        }

        // ============================================
        // SISTEMA DE DISE√ëO DE P√ÅGINA
        // ============================================
        
        function previewLogoDiseno(input) {
            const preview = document.getElementById('logoDisenoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 150px; max-height: 150px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function previewPortadaDiseno(input) {
            const preview = document.getElementById('portadaDisenoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function guardarDiseno() {
            const diseno = {
                nombre: document.getElementById('nombreTiendaDiseno').value,
                descripcion: document.getElementById('descripcionTiendaDiseno').value,
                color: document.getElementById('colorPrincipalDiseno').value,
                logo: document.getElementById('logoDiseno').files[0] ? 'logo_subido' : null,
                portada: document.getElementById('portadaDiseno').files[0] ? 'portada_subida' : null
            };
            
            localStorage.setItem('disenoPagina', JSON.stringify(diseno));
            mostrarAlerta('Dise√±o guardado exitosamente', 'success');
            
            // Actualizar vista previa
            actualizarVistaPrevia();
        }

        function actualizarVistaPrevia() {
            const diseno = JSON.parse(localStorage.getItem('disenoPagina') || '{}');
            const vistaPrevia = document.getElementById('vistaPreviaDiseno');
            
            if (diseno.nombre || diseno.descripcion) {
                vistaPrevia.innerHTML = `
                    <div class="text-center p-4" style="background: linear-gradient(135deg, ${diseno.color || '#7C3AED'}, #EC4899); color: white; border-radius: 8px;">
                        <h2>${diseno.nombre || 'Mi Tienda'}</h2>
                        <p>${diseno.descripcion || 'Descripci√≥n de mi tienda'}</p>
                        <div class="mt-3">
                            <span class="badge bg-light text-dark">Dise√±o Personalizado</span>
                        </div>
                    </div>
                `;
            }
        }

        // ============================================
        // SISTEMA DE FEEDBACKS
        // ============================================
        
        function cargarFeedbacks() {
            const feedbacks = JSON.parse(localStorage.getItem('feedbacksEnviados') || '[]');
            const lista = document.getElementById('listaFeedbacks');
            
            if (feedbacks.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay feedbacks enviados</p>';
                return;
            }
            
            let html = '';
            feedbacks.forEach((feedback, index) => {
                const fecha = new Date(feedback.fecha).toLocaleDateString();
                const prioridadIcon = {
                    'baja': 'üü¢',
                    'media': 'üü°',
                    'alta': 'üî¥',
                    'critica': 'üö®'
                };
                
                html += `
                    <div class="border p-3 mb-2 rounded">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6>${feedback.titulo}</h6>
                                <p class="text-muted mb-1">${feedback.descripcion.substring(0, 100)}...</p>
                                <small class="text-muted">${fecha}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-secondary">${prioridadIcon[feedback.prioridad]} ${feedback.prioridad}</span>
                                <br>
                                <span class="badge bg-primary">${feedback.tipo}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
        }

        // Event listener para formulario de feedback
        const formFeedback = document.getElementById('formFeedback');
        if (formFeedback) {
            formFeedback.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const feedback = {
                    tipo: document.getElementById('tipoFeedback').value,
                    titulo: document.getElementById('tituloFeedback').value,
                    descripcion: document.getElementById('descripcionFeedback').value,
                    prioridad: document.getElementById('prioridadFeedback').value,
                    fecha: new Date().toISOString()
                };
                
                // Validaci√≥n b√°sica
                if (!feedback.tipo || !feedback.titulo || !feedback.descripcion) {
                    mostrarAlerta('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }
                
                // Guardar feedback
                const feedbacks = JSON.parse(localStorage.getItem('feedbacksEnviados') || '[]');
                feedbacks.push(feedback);
                localStorage.setItem('feedbacksEnviados', JSON.stringify(feedbacks));
                
                // Limpiar formulario
                this.reset();
                
                // Recargar lista
                cargarFeedbacks();
                
                // Mostrar confirmaci√≥n
                mostrarAlerta('¬°Feedback enviado exitosamente! Gracias por tu contribuci√≥n.', 'success');
            });
        }

        // ============================================
        // SISTEMA DE HISTORIAL Y ACTIVIDAD
        // ============================================
        
        function cargarHistorialSesiones() {
            const sesiones = JSON.parse(localStorage.getItem('historialSesiones') || '[]');
            const tabla = document.getElementById('tablaSesiones');
            
            if (sesiones.length === 0) {
                tabla.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No hay historial de sesiones</td></tr>';
                return;
            }
            
            let html = '';
            sesiones.forEach(sesion => {
                const fecha = new Date(sesion.fecha).toLocaleString();
                const estado = sesion.exitoso ? '<span class="badge bg-success">Exitoso</span>' : '<span class="badge bg-danger">Fallido</span>';
                
                html += `
                    <tr>
                        <td>${fecha}</td>
                        <td>${sesion.ip || 'N/A'}</td>
                        <td>${sesion.dispositivo || 'N/A'}</td>
                        <td>${sesion.ubicacion || 'N/A'}</td>
                        <td>${estado}</td>
                    </tr>
                `;
            });
            
            tabla.innerHTML = html;
        }

        function cargarHistorialVentas() {
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            const tabla = document.getElementById('tablaVentasHistorial');
            
            if (ventas.length === 0) {
                tabla.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No hay historial de ventas</td></tr>';
                return;
            }
            
            let html = '';
            ventas.forEach((venta, index) => {
                const fecha = new Date(venta.fecha).toLocaleDateString();
                const estado = venta.estado || 'completada';
                const estadoBadge = {
                    'pendiente': '<span class="badge bg-warning">Pendiente</span>',
                    'completada': '<span class="badge bg-success">Completada</span>',
                    'cancelada': '<span class="badge bg-danger">Cancelada</span>'
                };
                
                html += `
                    <tr>
                        <td>${fecha}</td>
                        <td>${venta.cliente}</td>
                        <td>${venta.producto}</td>
                        <td>${venta.cantidad}</td>
                        <td>$${venta.total}</td>
                        <td>${estadoBadge[estado] || estadoBadge['completada']}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="verDetalleVenta(${index})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tabla.innerHTML = html;
        }

        function cargarHistorialTurnos() {
            const turnos = JSON.parse(localStorage.getItem('turnos') || '[]');
            const tabla = document.getElementById('tablaTurnosHistorial');
            
            if (turnos.length === 0) {
                tabla.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hay historial de turnos</td></tr>';
                return;
            }
            
            let html = '';
            turnos.forEach((turno, index) => {
                const fecha = new Date(turno.fecha).toLocaleDateString();
                const estado = turno.estado || 'programado';
                const estadoBadge = {
                    'programado': '<span class="badge bg-info">Programado</span>',
                    'confirmado': '<span class="badge bg-primary">Confirmado</span>',
                    'completado': '<span class="badge bg-success">Completado</span>',
                    'cancelado': '<span class="badge bg-danger">Cancelado</span>'
                };
                
                html += `
                    <tr>
                        <td>${fecha}</td>
                        <td>${turno.hora}</td>
                        <td>${turno.cliente}</td>
                        <td>${turno.servicio}</td>
                        <td>${estadoBadge[estado] || estadoBadge['programado']}</td>
                        <td>${turno.notas || 'Sin notas'}</td>
                    </tr>
                `;
            });
            
            tabla.innerHTML = html;
        }

        function cargarFeedbacksCompradores() {
            const feedbacks = JSON.parse(localStorage.getItem('feedbacksCompradores') || '[]');
            const lista = document.getElementById('listaFeedbacksCompradores');
            
            if (feedbacks.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay feedbacks de compradores</p>';
                return;
            }
            
            let html = '';
            feedbacks.forEach(feedback => {
                const fecha = new Date(feedback.fecha).toLocaleDateString();
                const estrellas = '‚≠ê'.repeat(feedback.calificacion);
                
                html += `
                    <div class="border p-3 mb-3 rounded">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6>${feedback.cliente}</h6>
                                <div class="mb-2">${estrellas} (${feedback.calificacion}/5)</div>
                                <p class="mb-1">${feedback.comentario}</p>
                                <small class="text-muted">${fecha}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-primary">${feedback.producto}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
            
            // Actualizar estad√≠sticas
            actualizarEstadisticasFeedbacks(feedbacks);
        }

        function actualizarEstadisticasFeedbacks(feedbacks) {
            if (feedbacks.length === 0) {
                document.getElementById('promedioEstrellas').textContent = '0.0';
                document.getElementById('totalFeedbacks').textContent = '0';
                document.getElementById('feedbacksPositivos').textContent = '0';
                return;
            }
            
            const promedio = feedbacks.reduce((sum, f) => sum + f.calificacion, 0) / feedbacks.length;
            const positivos = feedbacks.filter(f => f.calificacion >= 4).length;
            
            document.getElementById('promedioEstrellas').textContent = promedio.toFixed(1);
            document.getElementById('totalFeedbacks').textContent = feedbacks.length;
            document.getElementById('feedbacksPositivos').textContent = positivos;
        }

        // ============================================
        // SISTEMA DE ENV√çOS Y ENTREGA
        // ============================================
        
        function guardarConfiguracionEnvios() {
            const configuracion = {
                enviosDomicilio: document.getElementById('enviosDomicilio').checked,
                costoEnvio: parseFloat(document.getElementById('costoEnvio').value) || 0,
                envioGratisDesde: parseFloat(document.getElementById('envioGratisDesde').value) || 0,
                puntosEncuentro: document.getElementById('puntosEncuentro').checked,
                radioCobertura: parseInt(document.getElementById('radioCobertura').value) || 10,
                direccionBase: document.getElementById('direccionBase').value,
                motoMandado: document.getElementById('motoMandado').checked,
                precioPorKm: parseFloat(document.getElementById('precioPorKm').value) || 0.50,
                precioMinimoMoto: parseFloat(document.getElementById('precioMinimoMoto').value) || 5.00,
                tiempoPreparacion: parseInt(document.getElementById('tiempoPreparacion').value) || 30,
                horaInicioEntrega: document.getElementById('horaInicioEntrega').value,
                horaFinEntrega: document.getElementById('horaFinEntrega').value
            };
            
            localStorage.setItem('configuracionEnvios', JSON.stringify(configuracion));
            mostrarAlerta('Configuraci√≥n de env√≠os guardada exitosamente', 'success');
        }

        // ============================================
        // SISTEMA DE CAMBIO DE CONTRASE√ëA
        // ============================================
        
        const formCambiarPassword = document.getElementById('formCambiarPassword');
        if (formCambiarPassword) {
            formCambiarPassword.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const passwordActual = document.getElementById('passwordActual').value;
                const passwordNueva = document.getElementById('passwordNueva').value;
                const passwordConfirmar = document.getElementById('passwordConfirmar').value;
                
                // Validaciones
                if (!passwordActual || !passwordNueva || !passwordConfirmar) {
                    mostrarAlerta('Por favor completa todos los campos', 'error');
                    return;
                }
                
                if (passwordNueva !== passwordConfirmar) {
                    mostrarAlerta('Las contrase√±as no coinciden', 'error');
                    return;
                }
                
                if (passwordNueva.length < 6) {
                    mostrarAlerta('La nueva contrase√±a debe tener al menos 6 caracteres', 'error');
                    return;
                }
                
                // Simular cambio de contrase√±a (en producci√≥n esto ir√≠a al servidor)
                const cambioPassword = {
                    fecha: new Date().toISOString(),
                    exitoso: true
                };
                
                localStorage.setItem('ultimoCambioPassword', JSON.stringify(cambioPassword));
                const ultimoCambioElement = document.getElementById('ultimoCambioPassword');
                if (ultimoCambioElement) {
                    ultimoCambioElement.textContent = new Date().toLocaleString();
                }
                
                // Limpiar formulario
                this.reset();
                
                mostrarAlerta('Contrase√±a cambiada exitosamente', 'success');
            });
        }

        // ============================================
        // FUNCIONES DE FILTROS Y ESTAD√çSTICAS
        // ============================================
        
        function filtrarVentas() {
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            const filtroFecha = document.getElementById('filtroFechaVentas').value;
            const filtroCliente = document.getElementById('filtroClienteVentas').value.toLowerCase();
            const filtroEstado = document.getElementById('filtroEstadoVentas').value;
            
            let ventasFiltradas = ventas.filter(venta => {
                const cumpleFecha = !filtroFecha || new Date(venta.fecha).toDateString() === new Date(filtroFecha).toDateString();
                const cumpleCliente = !filtroCliente || venta.cliente.toLowerCase().includes(filtroCliente);
                const cumpleEstado = !filtroEstado || venta.estado === filtroEstado;
                
                return cumpleFecha && cumpleCliente && cumpleEstado;
            });
            
            actualizarListaVentas(ventasFiltradas);
        }

        function limpiarFiltrosVentas() {
            document.getElementById('filtroFechaVentas').value = '';
            document.getElementById('filtroClienteVentas').value = '';
            document.getElementById('filtroEstadoVentas').value = '';
            
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            actualizarListaVentas(ventas);
        }

        function actualizarListaVentas(ventas) {
            const lista = document.getElementById('listaVentas');
            
            if (ventas.length === 0) {
                lista.innerHTML = '<p class="text-muted">No hay ventas que coincidan con los filtros</p>';
                return;
            }
            
            let html = '';
            ventas.forEach((venta, index) => {
                const fecha = new Date(venta.fecha).toLocaleDateString();
                const estado = venta.estado || 'completada';
                const estadoBadge = {
                    'pendiente': '<span class="badge bg-warning">Pendiente</span>',
                    'completada': '<span class="badge bg-success">Completada</span>',
                    'cancelada': '<span class="badge bg-danger">Cancelada</span>'
                };
                
                html += `
                    <div class="border p-3 mb-3 rounded">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6>${venta.cliente}</h6>
                                <p class="text-muted mb-1">${venta.producto} x ${venta.cantidad}</p>
                                <small class="text-muted">${fecha}</small>
                            </div>
                            <div class="text-end">
                                <div class="h5 text-primary">$${venta.total}</div>
                                ${estadoBadge[estado] || estadoBadge['completada']}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
            actualizarEstadisticasVentas(ventas);
        }

        function actualizarEstadisticasVentas(ventas) {
            const total = ventas.reduce((sum, v) => sum + parseFloat(v.total), 0);
            const ventasMes = ventas.filter(v => {
                const fechaVenta = new Date(v.fecha);
                const fechaActual = new Date();
                return fechaVenta.getMonth() === fechaActual.getMonth() && 
                       fechaVenta.getFullYear() === fechaActual.getFullYear();
            });
            
            const totalMes = ventasMes.reduce((sum, v) => sum + parseFloat(v.total), 0);
            const promedio = ventas.length > 0 ? total / ventas.length : 0;
            
            document.getElementById('totalVentas').textContent = `$${total.toFixed(2)}`;
            document.getElementById('ventasMes').textContent = `$${totalMes.toFixed(2)}`;
            document.getElementById('promedioVenta').textContent = `$${promedio.toFixed(2)}`;
            document.getElementById('cantidadVentas').textContent = ventas.length;
        }

        // ============================================
        // FUNCIONES ADICIONALES
        // ============================================
        
        function cargarConfiguracionEnvios() {
            const config = JSON.parse(localStorage.getItem('configuracionEnvios') || '{}');
            
            if (config.enviosDomicilio !== undefined) {
                document.getElementById('enviosDomicilio').checked = config.enviosDomicilio;
            }
            if (config.costoEnvio) {
                document.getElementById('costoEnvio').value = config.costoEnvio;
            }
            if (config.envioGratisDesde) {
                document.getElementById('envioGratisDesde').value = config.envioGratisDesde;
            }
            if (config.puntosEncuentro !== undefined) {
                document.getElementById('puntosEncuentro').checked = config.puntosEncuentro;
            }
            if (config.radioCobertura) {
                document.getElementById('radioCobertura').value = config.radioCobertura;
            }
            if (config.direccionBase) {
                document.getElementById('direccionBase').value = config.direccionBase;
            }
            if (config.motoMandado !== undefined) {
                document.getElementById('motoMandado').checked = config.motoMandado;
            }
            if (config.precioPorKm) {
                document.getElementById('precioPorKm').value = config.precioPorKm;
            }
            if (config.precioMinimoMoto) {
                document.getElementById('precioMinimoMoto').value = config.precioMinimoMoto;
            }
            if (config.tiempoPreparacion) {
                document.getElementById('tiempoPreparacion').value = config.tiempoPreparacion;
            }
            if (config.horaInicioEntrega) {
                document.getElementById('horaInicioEntrega').value = config.horaInicioEntrega;
            }
            if (config.horaFinEntrega) {
                document.getElementById('horaFinEntrega').value = config.horaFinEntrega;
            }
        }

        function cargarUltimoCambioPassword() {
            const ultimoCambio = JSON.parse(localStorage.getItem('ultimoCambioPassword') || '{}');
            
            if (ultimoCambio.fecha) {
                document.getElementById('ultimoCambioPassword').textContent = new Date(ultimoCambio.fecha).toLocaleString();
            } else {
                document.getElementById('ultimoCambioPassword').textContent = 'Nunca';
            }
        }

        function exportarVentas() {
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            
            if (ventas.length === 0) {
                mostrarAlerta('No hay ventas para exportar', 'warning');
                return;
            }
            
            // Crear CSV
            let csv = 'Fecha,Cliente,Producto,Cantidad,Total,Estado\n';
            ventas.forEach(venta => {
                csv += `${venta.fecha},${venta.cliente},${venta.producto},${venta.cantidad},${venta.total},${venta.estado || 'completada'}\n`;
            });
            
            // Descargar archivo
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ventas_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            mostrarAlerta('Ventas exportadas exitosamente', 'success');
        }

        function verDetalleVenta(index) {
            const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
            const venta = ventas[index];
            
            if (!venta) {
                mostrarAlerta('Venta no encontrada', 'error');
                return;
            }
            
            const detalle = `
                <div class="modal fade" id="modalDetalleVenta" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Detalle de Venta</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p><strong>Cliente:</strong> ${venta.cliente}</p>
                                <p><strong>Producto:</strong> ${venta.producto}</p>
                                <p><strong>Cantidad:</strong> ${venta.cantidad}</p>
                                <p><strong>Total:</strong> $${venta.total}</p>
                                <p><strong>Fecha:</strong> ${new Date(venta.fecha).toLocaleString()}</p>
                                <p><strong>Estado:</strong> ${venta.estado || 'completada'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente si existe
            const modalExistente = document.getElementById('modalDetalleVenta');
            if (modalExistente) {
                modalExistente.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', detalle);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalDetalleVenta'));
            modal.show();
        }

        // ============================================
        // SISTEMA DE BACKUP Y RESTAURACI√ìN
        // ============================================
        
        class SistemaBackup {
            constructor() {
                this.inicializar();
            }
            
            inicializar() {
                console.log('üíæ Sistema de Backup inicializado');
                this.configurarBackupAutomatico();
            }
            
            configurarBackupAutomatico() {
                // Backup autom√°tico cada 30 minutos
                setInterval(() => {
                    this.crearBackup();
                }, 30 * 60 * 1000);
            }
            
            crearBackup() {
                const backup = {
                    fecha: new Date().toISOString(),
                    productos: JSON.parse(localStorage.getItem('productos') || '[]'),
                    servicios: JSON.parse(localStorage.getItem('servicios') || '[]'),
                    ventas: JSON.parse(localStorage.getItem('ventas') || '[]'),
                    configuracion: JSON.parse(localStorage.getItem('configuracionTienda') || '{}'),
                    analytics: JSON.parse(localStorage.getItem('analytics') || '{}')
                };
                
                const backups = JSON.parse(localStorage.getItem('backups') || '[]');
                backups.push(backup);
                
                // Mantener solo los √∫ltimos 10 backups
                if (backups.length > 10) {
                    backups.splice(0, backups.length - 10);
                }
                
                localStorage.setItem('backups', JSON.stringify(backups));
                console.log('üíæ Backup creado autom√°ticamente');
            }
            
            restaurarBackup(fecha) {
                const backups = JSON.parse(localStorage.getItem('backups') || '[]');
                const backup = backups.find(b => b.fecha === fecha);
                
                if (backup) {
                    localStorage.setItem('productos', JSON.stringify(backup.productos));
                    localStorage.setItem('servicios', JSON.stringify(backup.servicios));
                    localStorage.setItem('ventas', JSON.stringify(backup.ventas));
                    localStorage.setItem('configuracionTienda', JSON.stringify(backup.configuracion));
                    localStorage.setItem('analytics', JSON.stringify(backup.analytics));
                    
                    // Recargar datos
                    cargarProductos();
                    cargarServicios();
                    actualizarEstadisticas();
                    
                    mostrarAlerta('Backup restaurado exitosamente', 'success');
                }
            }
        }
        
        // ============================================
        // SISTEMA DE REPORTES
        // ============================================
        
        class SistemaReportes {
            constructor() {
                this.inicializar();
            }
            
            inicializar() {
                console.log('üìä Sistema de Reportes inicializado');
            }
            
            generarReporteVentas() {
                const ventas = JSON.parse(localStorage.getItem('ventas') || '[]');
                const analytics = JSON.parse(localStorage.getItem('analytics') || '{}');
                
                const reporte = {
                    fecha: new Date().toISOString(),
                    totalVentas: ventas.length,
                    totalIngresos: ventas.reduce((sum, venta) => sum + venta.total, 0),
                    promedioVenta: ventas.length > 0 ? ventas.reduce((sum, venta) => sum + venta.total, 0) / ventas.length : 0,
                    productosVendidos: ventas.reduce((sum, venta) => sum + venta.cantidad, 0),
                    analytics: analytics
                };
                
                return reporte;
            }
            
            exportarDatos() {
                const datos = {
                    productos: JSON.parse(localStorage.getItem('productos') || '[]'),
                    servicios: JSON.parse(localStorage.getItem('servicios') || '[]'),
                    ventas: JSON.parse(localStorage.getItem('ventas') || '[]'),
                    configuracion: JSON.parse(localStorage.getItem('configuracionTienda') || '{}'),
                    analytics: JSON.parse(localStorage.getItem('analytics') || '{}')
                };
                
                const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cresalia-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // ============================================
        // SISTEMA DE TEMAS Y PERSONALIZACI√ìN
        // ============================================
        
        class SistemaTemas {
            constructor() {
                this.temas = {
                    'default': {
                        primary: '#7C3AED',
                        secondary: '#EC4899',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6'
                    },
                    'dark': {
                        primary: '#8B5CF6',
                        secondary: '#F472B6',
                        success: '#34D399',
                        warning: '#FBBF24',
                        danger: '#F87171',
                        info: '#60A5FA'
                    },
                    'ocean': {
                        primary: '#0EA5E9',
                        secondary: '#06B6D4',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6'
                    }
                };
                
                this.inicializar();
            }
            
            inicializar() {
                console.log('üé® Sistema de Temas inicializado');
                this.aplicarTema();
            }
            
            aplicarTema(nombre = 'default') {
                const tema = this.temas[nombre];
                if (!tema) return;
                
                const root = document.documentElement;
                Object.entries(tema).forEach(([prop, valor]) => {
                    root.style.setProperty(`--${prop}-color`, valor);
                });
                
                localStorage.setItem('temaSeleccionado', nombre);
            }
            
            cambiarTema(nombre) {
                this.aplicarTema(nombre);
                mostrarAlerta(`Tema ${nombre} aplicado`, 'info');
            }
        }
        
        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        
        // Variables globales
        let sistemaInterconexiones;
        let sistemaAnalytics;
        let sistemaPagos;
        let sistemaNotificaciones;
        let sistemaSeguridad;
        let sistemaBackup;
        let sistemaReportes;
        let sistemaTemas;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Panel de administraci√≥n inicializado');
            
            // Inicializar sistemas
            sistemaInterconexiones = new SistemaInterconexiones();
            sistemaAnalytics = new SistemaAnalytics();
            sistemaPagos = new SistemaPagos();
            sistemaNotificaciones = new SistemaNotificaciones();
            sistemaSeguridad = new SistemaSeguridad();
            sistemaBackup = new SistemaBackup();
            sistemaReportes = new SistemaReportes();
            sistemaTemas = new SistemaTemas();
            
            // Hacer sistemas globales
            window.sistemaInterconexiones = sistemaInterconexiones;
            window.sistemaAnalytics = sistemaAnalytics;
            window.sistemaPagos = sistemaPagos;
            window.sistemaNotificaciones = sistemaNotificaciones;
            window.sistemaSeguridad = sistemaSeguridad;
            window.sistemaBackup = sistemaBackup;
            window.sistemaReportes = sistemaReportes;
            window.sistemaTemas = sistemaTemas;
            
            // Cargar datos
            cargarProductos();
            cargarServicios();
            actualizarEstadisticas();
            
            // Cargar configuraci√≥n
            const config = JSON.parse(localStorage.getItem('configuracionTienda') || '{}');
            if (config.nombre) {
                document.getElementById('nombreTienda').value = config.nombre;
            }
            if (config.email) {
                document.getElementById('emailTienda').value = config.email;
            }
            
            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                sistemaNotificaciones.crearNotificacion('¬°Bienvenido a tu panel de administraci√≥n!', 'success');
            }, 1000);
            
            // Verificar restricciones de plan
            mostrarRestriccionesPlan();
            
            // Cargar configuraciones guardadas
            cargarConfiguracionesGuardadas();
            
            // Verificar usuario nuevo despu√©s de un peque√±o delay
            setTimeout(() => {
                verificarUsuarioNuevo();
            }, 500);
            
            // Inicializar formularios de forma segura
            inicializarFormularios();
        });
        
        // ============================================
        // INICIALIZACI√ìN SEGURA DE FORMULARIOS
        // ============================================
        
        function inicializarFormularios() {
            console.log('üîß Inicializando formularios...');
            
            // Lista de formularios a inicializar
            const formularios = [
                'formProducto',
                'formServicio', 
                'formTurno',
                'formVenta',
                'formOferta',
                'formContacto',
                'formFAQ',
                'formCrisla',
                'formFeedback',
                'formCambiarPassword'
            ];
            
            formularios.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    console.log(`‚úÖ Formulario ${formId} encontrado y listo`);
                } else {
                    console.warn(`‚ö†Ô∏è Formulario ${formId} no encontrado`);
                }
            });
            
            // Verificar que las funciones de modales est√©n disponibles
            if (typeof abrirModal === 'function' && typeof cerrarModal === 'function') {
                console.log('‚úÖ Funciones de modales disponibles');
            } else {
                console.error('‚ùå Funciones de modales no disponibles');
            }
            
            console.log('üéâ Inicializaci√≥n de formularios completada');
        }
        
        // ============================================
        // FUNCI√ìN DE PRUEBA DE FORMULARIOS
        // ============================================
        
        function probarFormularios() {
            console.log('üß™ Probando formularios...');
            
            const formularios = [
                'formProducto',
                'formServicio', 
                'formTurno',
                'formVenta',
                'formOferta',
                'formContacto',
                'formFAQ',
                'formCrisla',
                'formFeedback',
                'formCambiarPassword'
            ];
            
            formularios.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    console.log(`‚úÖ Formulario ${formId} est√° disponible`);
                    
                    // Verificar que tenga event listeners
                    const hasEventListeners = form.onsubmit !== null || 
                        (form.addEventListener && typeof form.addEventListener === 'function');
                    
                    if (hasEventListeners) {
                        console.log(`‚úÖ Formulario ${formId} tiene event listeners`);
                    } else {
                        console.warn(`‚ö†Ô∏è Formulario ${formId} no tiene event listeners`);
                    }
                } else {
                    console.error(`‚ùå Formulario ${formId} no encontrado`);
                }
            });
            
            // Verificar funciones de modales
            if (typeof abrirModal === 'function') {
                console.log('‚úÖ Funci√≥n abrirModal disponible');
            } else {
                console.error('‚ùå Funci√≥n abrirModal no disponible');
            }
            
            if (typeof cerrarModal === 'function') {
                console.log('‚úÖ Funci√≥n cerrarModal disponible');
            } else {
                console.error('‚ùå Funci√≥n cerrarModal no disponible');
            }
            
            console.log('üéâ Prueba de formularios completada');
        }
        
        // Hacer funci√≥n de prueba global
        window.probarFormularios = probarFormularios;
    </script>
</body>
</html>
